var debug=true;$.urlParam=function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);if(results==null){return null}else{return decodeURI(results[1])||0}};var pageID=$.urlParam("id");var page=$.urlParam("p");var page1=$.urlParam("sp");var page2=$.urlParam("ssp");if(debug){console.log("Jquery Parse URL | Data => pageID - "+pageID+" | page - "+page+" | page1 - "+page1+" | page2 - "+page2+"")}$wrapLimitRange={min:aceEditor.acewraplimit,max:aceEditor.acewraplimit};function aceboolean(param){if(param=="1"){return true}else{return false}}if($("#htmleditor").length){var htmlACE=ace.edit("htmleditor");htmlACE.setTheme("ace/theme/"+aceEditor.acetheme);htmlACE.session.setUseWrapMode(aceEditor.aceactivewrap);htmlACE.session.setWrapLimitRange($wrapLimitRange.min,$wrapLimitRange.max);htmlACE.setOptions({mode:"ace/mode/html_ruby",tabSize:aceEditor.acetabSize,useSoftTabs:true,indentedSoftWrap:false,highlightActiveLine:aceboolean(aceEditor.aceactiveline),showPrintMargin:false,fontSize:aceEditor.fontSize,showInvisibles:aceEditor.aceinvisible,showGutter:aceboolean(aceEditor.acegutter)});htmlACE.$blockScrolling=Infinity;var texthtml=$("#envo_editor").val();htmlACE.session.setValue(texthtml)}function getGPS_Data(event){event.preventDefault();if(debug){console.log("----------- fn getGPS_Data -----------")}var parent=$(this).parents(":eq(4)").attr("id");var street=$.trim($("#"+parent+' input[name="envo_entstreet"]').val()).replace(/\s/g,"+");var city=$.trim($('select[name="envo_housecity"] option:selected').text()).replace(/\s/g,"+");var datagps=street+","+city;if(debug){console.log("GPS Click fn | Parent ID: "+parent);console.log("GPS Click fn | Adress: "+datagps)}$.ajax({url:"https://nominatim.openstreetmap.org/search?q="+datagps+"&format=json&addressdetails=1",dataType:"json",timeout:3e4,beforeSend:function(){$("#"+parent+" .loadingdata_gps").html("Načítání ... Prosím počkejte");$("#"+parent+" .loadingdata_gps").css("visibility","visible");$("#"+parent+" .loadingdata_ikatastr").html("Načítání ... Prosím počkejte");$("#"+parent+" .loadingdata_ikatastr").css("visibility","visible")},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);$.each(result,function(key,data){if(debug){console.log("GPS Click fn | OpenStreetMaps | GPS data - Latitude: "+data.lat+" / Longitude: "+data.lon)}var ikatastr="https://www.ikatastr.cz/#kde="+data.lat+","+data.lon+",19&mapa=osm&vrstvy=parcelybudovy&info="+data.lat+","+data.lon;$("#"+parent+" input[name=envo_housegpslat]").val(data.lat).css("background-color","#FFF5CC");$("#"+parent+" input[name=envo_housegpslng]").val(data.lon).css("background-color","#FFF5CC");$("#"+parent+" input[name=envo_houseikatastr]").val(ikatastr).css("background-color","#FFF5CC");setTimeout(function(){$("#"+parent+" input[name=envo_housegpslat]").css("background-color","#FFF");$("#"+parent+" input[name=envo_housegpslng]").css("background-color","#FFF");$("#"+parent+" input[name=envo_houseikatastr]").css("background-color","#FFF")},8e3);$("#"+parent+" .gps_link a.mapycz").attr("href","http://www.mapy.cz/#q="+data.lat+"%2C"+data.lon);$("#"+parent+" .gps_link a.openstreet").attr("href","https://www.openstreetmap.org/?mlat="+data.lat+"&mlon="+data.lon+"&zoom=16#map=18/"+data.lat+"/"+data.lon);$("#"+parent+" .ikatastrlink a.ikatastr").attr("href",ikatastr);$("#"+parent+" .gps_link").show()});setTimeout(function(){$("#"+parent+" .loadingdata_gps").css("visibility","hidden");$("#"+parent+" .loadingdata_ikatastr").css("visibility","hidden")},1e3)},error:function(){setTimeout(function(){$("#"+parent+" .loadingdata_gps").css("visibility","hidden");$("#"+parent+" .loadingdata_ikatastr").css("visibility","hidden")},1e3)}});return false}function initializeTinyMce(selector,height){if(selector==undefined){selector="textarea"}tinymce.init({selector:selector,theme:"modern",width:"100%",height:height,language:envoWeb.envo_lang,content_style:".mce-content-body {font-size:12px;}",entity_encoding:"raw",plugins:["advlist autolink link charmap hr insertdatetime textcolor responsivefilemanager","searchreplace visualblocks paste","table"],paste_as_text:true,menubar:"edit insert view format table",toolbar:"undo redo | bold italic | alignleft aligncenter alignjustify | bullist numlist | forecolor backcolor",statusbar:false,valid_elements:"*[*]",insertdatetime_formats:["%H:%M:%S","%Y-%m-%d","%d.%m.%Y","%I:%M:%S %p","%D"],external_filemanager_path:"/assets/plugins/tinymce/plugins/filemanager/",filemanager_title:"Filemanager",external_plugins:{filemanager:"plugins/filemanager/plugin.min.js"}})}function initializeDateTimePicker(selector){$(selector).datetimepicker({locale:envoWeb.envo_lang,format:"DD.MM.YYYY",icons:$.AdminEnvo.DateTimepicker.icons(),tooltips:$.AdminEnvo.DateTimepicker.tooltips(),showTodayButton:true,showClear:true,calendarWeeks:true,ignoreReadonly:true})}function formatFileSize(bytes){if(typeof bytes!=="number"){return""}if(bytes>=1e9){return(bytes/1e9).toFixed(2)+" GB"}if(bytes>=1e6){return(bytes/1e6).toFixed(2)+" MB"}return(bytes/1e3).toFixed(2)+" KB"}$(function(){"use strict";if(page2!=null){initializeTinyMce("textarea.envoEditorLarge","200")}});$(function(){"use strict";function msToTime(s){function pad(n,z){z=z||2;return("00"+n).slice(-z)}var ms=s%1e3;s=(s-ms)/1e3;var secs=s%60;s=(s-secs)/60;var mins=s%60;var hrs=(s-mins)/60;return pad(mins)+":"+pad(secs)+"."+pad(ms,3)}$('input[name="envo_houseic"]').on("keyup keypress input paste change",function(){var getic=$.trim($(this).val()).replace(/\s/g,"");$("#ares_res a:first").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_res.cgi?ico="+getic+"&jazyk=cz&xml=1");$("#ares_res a:last-child").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_vreo.cgi?ico="+getic+"&jazyk=cz&xml=1");$("#justice_vor a").attr("href","https://or.justice.cz/ias/ui/rejstrik-$firma?ico="+getic+"&jenPlatne=VSECHNY")});$('input[name="envo_houseares"]').change(function(){if(this.value=="1"){$("#ares_res").show()}else if(this.value=="0"){$("#ares_res").hide()}});$('input[name="envo_housejustice"]').change(function(){if(this.value=="1"){$("#justice_vor").show()}else if(this.value=="0"){$("#justice_vor").hide()}});$(".getgps").click(getGPS_Data);$("input[name=envo_houseikatastr]").keyup(function(){var parent=$(this).parents(":eq(4)").attr("id");var getkatastr=$.trim($(this).val()).replace(/\s/g,"");if($(this).val().length>0){$("#"+parent+" .ikatastrlink a").attr("href",getkatastr)}else{$("#"+parent+" .ikatastrlink a").attr("href","https://www.ikatastr.cz/")}if(debug){console.log("Katastr Keyup fn | Parent ID: "+parent+" | Text: "+getkatastr)}});$("#loadAres").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #loadAres click -----------")}var ic=$.trim($('input[name="envo_dataares"]').val()).replace(/\s/g,"");var ajaxTime=(new Date).getTime();$.ajax({url:"/plugins/intranet2/admin/ajax/ares.php",contentType:"application/json; charset=utf-8",dataType:"json",data:"ic="+ic,cache:false,beforeSend:function(){$("#loadingdata_ares").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){if(data.status=="upload_success"){$("#loadingdata_ares").hide();$("#loadingdata_ares").html("");var divdata="";divdata+='<div class="col-sm-12"><h5>Získaná data z Ares databáze</h5><hr>'+"<p><strong>"+data.status_msg+"</strong></p>"+'<p>Doba načtení dat z ARESu: <span id="ajaxTime"></span></p><hr>'+'<table class="table">'+"<tbody>"+"<tr>"+'<th style="border-top: none;border-bottom: 1px solid #DEE2E6;" class="col-sm-4">Název</th>'+'<td class="col-sm-8">'+data.name+"</td>"+"</tr>"+"<tr>"+'<th style="border-top: none;border-bottom: 1px solid #DEE2E6;" class="col-sm-4">Katastrální území</th>'+'<td class="col-sm-8">'+data.katastralniuzemi+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>";$("#aresoutput").html("").prepend(divdata).show();$("input[name=envo_housename]").val("SVJ domu .....");$("input[name=envo_househeadquarters]").val(data.ulice+", "+data.mesto+" - "+data.katastralniuzemi+", PSČ "+data.psc).css("background-color","#FFF5CC");$("input[name=envo_houseic]").val(data.ic).css("background-color","#FFF5CC");$("input[name=envo_housestreet]").val(data.ulice).css("background-color","#FFF5CC");$("input[name=envo_housepsc]").val(data.psc).css("background-color","#FFF5CC");if($("input[name=envo_housefname]").length){$("input[name=envo_housefname]").val(data.name).css("background-color","#FFF5CC")}if($("input[name=envo_housefstreet]").length){$("input[name=envo_housefstreet]").val(data.ulice).css("background-color","#FFF5CC")}if($("input[name=envo_housefcity]").length){$("input[name=envo_housefcity]").val(data.mesto).css("background-color","#FFF5CC")}if($("input[name=envo_housefpsc]").length){$("input[name=envo_housefpsc]").val(data.psc).css("background-color","#FFF5CC")}if($("input[name=envo_housefic]").length){$("input[name=envo_housefic]").val(data.ic).css("background-color","#FFF5CC")}if($("input[name=envo_housefdic]").length){$("input[name=envo_housefdic]").val(data.dic).css("background-color","#FFF5CC")}setTimeout(function(){$("input[name=envo_househeadquarters]").css("background-color","#FFF");$("input[name=envo_housestreet]").css("background-color","#FFF");$("input[name=envo_houseic]").css("background-color","#FFF");$("input[name=envo_housepsc]").css("background-color","#FFF");$("input[name=envo_housefname]").css("background-color","#FFF");$("input[name=envo_housefstreet]").css("background-color","#FFF");$("input[name=envo_housefcity]").css("background-color","#FFF");$("input[name=envo_housefpsc]").css("background-color","#FFF");$("input[name=envo_housefic]").css("background-color","#FFF");$("input[name=envo_housefdic]").css("background-color","#FFF")},8e3);$("#ares_res a:first").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_res.cgi?ico="+ic+"&jazyk=cz&xml=1");$("#ares_res a:last-child").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_vreo.cgi?ico="+ic+"&jazyk=cz&xml=1");$("#justice_vor a").attr("href","https://or.justice.cz/ias/ui/rejstrik-$firma?ico="+ic+"&jenPlatne=VSECHNY");$('input[name=envo_houseares][value="1"]').prop("checked",true);$('input[name=envo_housejustice][value="1"]').prop("checked",true);$("#ares_res,#justice_vor").show()}else{$("#loadingdata_ares").hide();$("#loadingdata_ares").html("");var divdata="";divdata+='<div class="col-sm-12"><h5>Výstup z Ares</h5>'+'<p style="color: #C10000;"><i class="fa fa-exclamation"></i> <strong>'+data.status_msg+"</strong></p><hr>"+"</div>";$("#aresoutput").html("").prepend(divdata).show();setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}},error:function(){},complete:function(){var totalTime=Math.floor((new Date).getTime()-ajaxTime);$("#ajaxTime").html(msToTime(totalTime))}})})});$(function(){"use strict";initializeDateTimePicker("#datepickerTime")});$(function(){"use strict";$("#int2_table").dataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Czech.json"},order:[],columnDefs:[{targets:"no-sort",orderable:false}],pageLength:dataTablesSettings.pageLenght,dom:"<'row'<'col-sm-6'<'float-left m-b-20'f>><'col-sm-6'<'float-right m-r-20 hidden-xs'B>>>"+"<'row'<'col-sm-12'tr>>"+"<'row '<'col-sm-7'i><'float-right col-sm-5'p>>"})});$(function(){"use strict";$("#envo_delete_all").click(function(){var checkedStatus=this.checked;if(checkedStatus){$("#button_delete").prop("disabled",false)}else{$("#button_delete").attr("disabled",true)}$(".highlight").each(function(){$(this).prop("checked",checkedStatus)})});$(".highlight").change(function(){if(this.checked){$("#button_delete").prop("disabled",false)}else{if($(".highlight").filter(":checked").length<1){$("#envo_delete_all").prop("checked",false);$("#button_delete").attr("disabled",true)}}})});$(function(){"use strict";function selecthouse(event){event.preventDefault();var valID=$(this).attr("data-value");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_houseselect_process.php",type:"POST",datatype:"json",data:{valID:valID},success:function(data){var res=$.parseJSON(data);$('input[name="envo_housename"]').val(res.name);$('input[name="envo_househeadquarters"]').val(res.headquarters);$('input[name="envo_housestreet"]').val(res.street);$('select[name="envo_housecity"]').val(res.city);$('select[name="envo_housecityarea"]').val(res.cityarea);$('input[name="envo_housepsc"]').val(res.psc);$('input[name="envo_houseic"]').val(res.ic);$('input[name="envo_dataares"]').val(res.ic);$('input[name="envo_housefname"]').val(res.housefname);$('input[name="envo_housefstreet"]').val(res.housefstreet);$('input[name="envo_housefcity"]').val(res.housefcity);$('input[name="envo_housefpsc"]').val(res.housefpsc);$('input[name="envo_housefic"]').val(res.housefic);$('input[name="envo_housefdic"]').val(res.housefdic);$('select[name="envo_estatemanagement"]').val(res.estatemanagement);$("select[name=envo_housecity]").trigger("change");$("select[name=envo_housecityarea]").trigger("change");$("select[name=envo_estatemanagement]").trigger("change");$("#ENVOModalPlugin").modal("hide")},error:function(){alert("failure")}});return false}$("#houseSelect").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #houseSelect click -----------")}var altura=$(window).height()-155;$("#ENVOModalPlugin .modal-body").css({height:altura,"overflow-y":"auto"});$.ajax({url:"/plugins/intranet2/admin/ajax/int2_houseselect_modal.php",type:"POST",dataType:"html",beforeSend:function(){$("#ENVOModalPlugin .modal-body").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>');$("#ENVOModalPlugin").modal("show")},success:function(data){setTimeout(function(){$("#ENVOModalPlugin .modal-body").hide().html(data).fadeIn(900);$(".selecthouse").click(selecthouse);$("#int_table").dataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Czech.json"},order:[],columnDefs:[{targets:"no-sort",orderable:false}],pageLength:dataTablesSettings.pageLenght,dom:"<'row'<'col-sm-6'<'float-left m-b-20'f>><'col-sm-6'<'float-right m-r-20 hidden-xs'B>>>"+"<'row'<'col-sm-12'tr>>"+"<'row '<'col-sm-7'i><'float-right col-sm-5'p>>"})},1e3)},error:function(){}})})});$(function(){"use strict";$(".copyadress").click(function(e){e.preventDefault();if(debug){console.log("----------- fn .copyadress click -----------")}var street1=$("input[name=envo_housestreet]").val();if($("input[name=envo_entstreet]").length){var street2=$("input[name=envo_entstreet]").val()}else{var street2=""}var city=$("select[name=envo_housecity]").find("option:selected").text();if(street2.length>0){var adress=street2+", "+city}else{var adress=street1+", "+city}if(debug){console.log("Copyadress Click fn | Adress: "+adress)}var dummy=document.createElement("input");document.body.appendChild(dummy);dummy.setAttribute("id","dummy_id");document.getElementById("dummy_id").value=adress;dummy.select();document.execCommand("copy");document.body.removeChild(dummy)})});$(function(){"use strict";function clickTaskHeader(){if(debug){console.log("----------- fn clickTaskHeader -----------")}var header=$(this);var text=header.children("span.collapsetask");var content=header.next().next();content.slideToggle(500,function(){text.text(function(){return content.is(":visible")?"-":"+"})})}function openDialogNewTask(event){event.preventDefault();if(debug){console.log("----------- fn openDialogNewTask -----------")}var DataDialog=$(this).attr("data-dialog");var houseID=pageID;if(debug){console.log("Add New Task Click fn | Dialog ID: "+DataDialog)}$("#"+DataDialog+" .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>');setTimeout(function(){$("#"+DataDialog+" .dialog__overview").load("/plugins/intranet2/admin/ajax/content_new_task.php",function(responseTxt,statusTxt,xhr){if(statusTxt=="success"){if(debug){console.log("Loading content | External content loaded successfully!")}try{tinymce.remove("textarea.envoEditorSmall")}catch(e){}initializeTinyMce("textarea.envoEditorSmall",300);$("#"+DataDialog+" .selectpicker").select2({minimumResultsForSearch:-1,dropdownParent:$(".page-content-wrapper"),dropdownCssClass:"zindex1060"});initializeDateTimePicker("input[name=envo_addtasktime]");initializeDateTimePicker("input[name=envo_addtaskreminder]")}if(statusTxt=="error"){if(debug){console.log("Loading content | Error: "+xhr.status+": "+xhr.statusText)}}})},1e3);var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}$("#"+DataDialog+" .dialog__overview").html("");$("#saveTask").attr("disabled",false)}});dlg.toggle(dlg);return false}function openDialogEditTask(event){event.preventDefault();if(debug){console.log("----------- fn openDialogEditTask -----------")}var DataDialog=$(this).attr("data-dialog");var taskID=$(this).attr("data-id");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_dialog_task.php",type:"POST",datatype:"html",data:{taskID:taskID},beforeSend:function(){$("#"+DataDialog+" .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>')},success:function(data){setTimeout(function(){$("#"+DataDialog+" .dialog__overview").hide().html(data).fadeIn(900);try{tinymce.remove("textarea.envoEditorSmall")}catch(e){}initializeTinyMce("textarea.envoEditorSmall",300);$("#"+DataDialog+" .selectpicker").select2({minimumResultsForSearch:-1,dropdownParent:$(".page-content-wrapper"),dropdownCssClass:"zindex1060"});initializeDateTimePicker("input[name=envo_edittasktime]");initializeDateTimePicker("input[name=envo_edittaskreminder]")},1e3)},error:function(){},complete:function(){}});var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}$("#"+DataDialog+" .dialog__overview").html("")}});dlg.toggle(dlg);return false}function deleteTask(taskID){if(debug){console.log("----------- fn deleteTask -----------")}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_delete_task.php",type:"POST",datatype:"json",data:{taskID:taskID},success:function(data){if(data.status=="delete_success"){$("#task_"+data.data[0].id).remove();setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:5e3})},1e3)}},complete:function(){},error:function(){}});return false}function confirmDeleteTask(event){event.preventDefault();if(debug){console.log("----------- fn confirmDeleteTask -----------")}var taskID=$(this).attr("data-id");bootbox.setLocale(envoWeb.envo_lang);bootbox.confirm({title:"Potvrzení o odstranění!",message:$(this).attr("data-confirm-deltask"),className:"bootbox-confirm-del",animate:true,buttons:{confirm:{className:"btn-success"},cancel:{className:"btn-danger"}},callback:function(result){if(result==true){if(debug){console.log("Delete Task - ID: "+taskID)}deleteTask(taskID)}}});return false}$(".taskheader").click(clickTaskHeader);$("#addTask").click(openDialogNewTask);$("#saveTask").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #saveTask click -----------")}var $this=$(this);var houseID=pageID;var priority=$("select[name=envo_addtaskpriority]").val();var status=$("select[name=envo_addtaskstatus]").val();var title=$("input[name=envo_addtasktitle]").val();var description=tinymce.get("envoEditorSmall").getContent();var reminder=$("input[name=envo_addtaskreminder]");var reminderval=reminder.val();var time=$("input[name=envo_addtasktime]");var timeval=time.val();if(debug){console.log("Save Task Click fn | Data => houseID - "+houseID+" | priority -  "+priority+" | status - "+status+" | title - "+title+" | description - "+description+" | reminderval - "+reminderval+" | timeval - "+timeval)}if(timeval.length){if(reminderval.length){$.ajax({type:"POST",url:"/plugins/intranet2/admin/ajax/int2_table_addnew_task.php",datatype:"json",data:{houseID:houseID,priority:priority,status:status,title:title,description:description,reminder:reminderval,time:timeval},success:function(data){if(data.status=="success"){var str=JSON.stringify(data);var result=JSON.parse(str);var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Save Task Click fn | Ajax -> Key data[id]: "+data["id"])}dataID=data["id"];divdata+='<div id="task_'+data["id"]+'" class="task_'+data["id"]+'">'+'<div class="taskheader bg-teal-600"><span>Task ID '+data["id"]+'</span><span class="float-right collapsetask">+</span></div>'+'<div class="taskinfo">'+'<div class="table-responsive">'+'<table class="table table-task">'+"<thead>"+"<tr>"+"<th>Titulek</th>"+"<th>Priorita</th>"+"<th>Status</th>"+"<th>Datum Úkolu</th>"+"<th>Datum Připomenutí</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+"<tr>"+"<td>"+data["title"]+"</td>"+"<td>"+data["priority"]+"</td>"+"<td>"+data["status"]+"</td>"+"<td>"+data["time"]+"</td>"+"<td>"+data["reminder"]+"</td>"+'<td class="text-center"><button type="button" id="editTask" class="btn btn-default btn-xs m-r-20 editTask" data-toggle="tooltipEnvo" title="" data-dialog="taskDialogEdit" data-original-title="Editovat" data-id="'+data["id"]+'"><i class="fa fa-edit"></i></button>'+'<button type="button" class="btn btn-danger btn-xs deleteTask" data-confirm-deltask="Jste si jistý, že chcete odstranit úkol <strong>'+data["title"]+'</strong>" data-toggle="tooltipEnvo" title="Odstranit" data-id="'+data["id"]+'"><i class="fa fa-trash-o"></i></button></td>'+"</tr>"+"</tbody>"+"</table>"+"</div>"+"</div>"+'<div class="taskcontent">'+"<p><strong >Popis Úkolu:</strong></p>"+'<div class="taskdescription">'+data["description"]+"</div>"+"</div>"+"</div>"})}});var divalert=$("#tasklist .alert.bg-info");if(divalert){divalert.parent().remove()}$("#tasklist").prepend(divdata);$("#task_"+dataID+" .taskheader").click(clickTaskHeader);$("#task_"+dataID+" .editTask").click(openDialogEditTask);$("#task_"+dataID+" .deleteTask").click(confirmDeleteTask);$this.attr("disabled",true);$("#task_notify_add").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$this.attr("disabled",true);$("#task_notify_add").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(){}})}else{reminder.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E02")}}}else{time.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E01")}}});$(".editTask").click(openDialogEditTask);$("#udpateTask").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #udpateTask click -----------")}var taskID=$("input[name=envo_edittaskid]").val();var houseID=pageID;var priority=$("select[name=envo_edittaskpriority]").val();var status=$("select[name=envo_edittaskstatus]").val();var title=$("input[name=envo_edittasktitle]").val();var description=tinymce.get("envoEditorSmall").getContent();var reminder=$("input[name=envo_edittaskreminder]");var reminderval=reminder.val();var time=$("input[name=envo_edittasktime]");var timeval=time.val();if(timeval.length){if(reminderval.length){$.ajax({type:"POST",url:"/plugins/intranet2/admin/ajax/int2_table_update_task.php",datatype:"json",data:{taskID:taskID,houseID:houseID,priority:priority,status:status,title:title,description:description,reminder:reminderval,time:timeval},success:function(data){if(data.status=="update_success"){var str=JSON.stringify(data);var result=JSON.parse(str);var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Save Task Click fn | Ajax -> Key data[id]: "+data["id"])}dataID=data["id"];if(data["description"]>0){description=data["description"]}else{description='<span class="bold text-warning-dark">Úkol nemá popis</span>'}divdata+='<div class="taskheader bg-teal-600"><span>Task ID '+data["id"]+'</span><span class="float-right collapsetask">+</span></div>'+'<div class="taskinfo">'+'<div class="table-responsive">'+'<table class="table table-task">'+"<thead>"+"<tr>"+"<th>Titulek</th>"+"<th>Priorita</th>"+"<th>Status</th>"+"<th>Datum Úkolu</th>"+"<th>Datum Připomenutí</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+"<tr>"+"<td>"+data["title"]+"</td>"+"<td>"+data["priority"]+"</td>"+"<td>"+data["status"]+"</td>"+"<td>"+data["time"]+"</td>"+"<td>"+data["reminder"]+"</td>"+'<td class="text-center"><button type="button" id="editTask" class="btn btn-default btn-xs m-r-20 editTask" data-toggle="tooltipEnvo" title="" data-dialog="taskDialogEdit" data-id="'+data["id"]+'" data-original-title="Editovat"><i class="fa fa-edit"></i></button>'+'<button type="button" class="btn btn-danger btn-xs deleteTask" data-confirm-deltask="Jste si jistý, že chcete odstranit úkol <strong>'+data["title"]+'</strong>" data-toggle="tooltipEnvo" title="Odstranit" data-id="'+data["id"]+'"><i class="fa fa-trash-o"></i></button></td>'+"</tr>"+"</tbody>"+"</table>"+"</div>"+"</div>"+'<div class="taskcontent">'+"<p><strong >Popis Úkolu:</strong></p>"+'<div class="taskdescription">'+description+"</div>"+"</div>"})}});$("#task_"+dataID).html(divdata);$("#task_"+dataID+" .taskheader").click(clickTaskHeader);$("#task_"+dataID+" .editTask").click(openDialogEditTask);$("#task_"+dataID+" .deleteTask").click(confirmDeleteTask);$("#task_notify_edit").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$("#task_notify_edit").pgNotification({style:"bar",message:data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(){}})}else{reminder.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E02")}}}else{time.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E01")}}});$(".deleteTask").click(confirmDeleteTask)});$(function(){"use strict";function openDialogNewEnt(event){event.preventDefault();if(debug){console.log("----------- fn openDialogNewEnt -----------")}var DataDialog=$(this).attr("data-dialog");var houseID=pageID;var entrance=$(event.data.element);var entranceval=entrance.val();if(debug){console.log("Add New Entrance Click fn | Dialog ID: "+DataDialog)}if(entranceval.length){$("#"+DataDialog+" .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>');entrance.parent().removeClass("has-error");setTimeout(function(){$("#"+DataDialog+" .dialog__overview").load("/plugins/intranet2/admin/ajax/content_new_ent.php",function(responseTxt,statusTxt,xhr){if(statusTxt=="success"){if(debug){console.log("Loading content | External content loaded successfully!")}$("#"+DataDialog+' input[name="envo_entstreet"]').val(entranceval);$(".getgps").click(getGPS_Data)}if(statusTxt=="error"){if(debug){console.log("Loading content | Error: "+xhr.status+": "+xhr.statusText)}}})},1e3);var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}entrance.val("");$("#"+DataDialog+" .dialog__overview").html("");$("#saveEnt").attr("disabled",false)}});dlg.toggle(dlg)}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+"Zadejte ulici a číslo vchodu."},{type:"danger",delay:5e3})},1e3);entrance.parent().addClass("has-error")}return false}function openDialogEditEnt(event){event.preventDefault();if(debug){console.log("----------- fn openDialogEditEnt -----------")}var DataDialog=$(this).attr("data-dialog");var entID=$(this).attr("data-id");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_dialog_ent.php",type:"POST",datatype:"html",data:{entID:entID},beforeSend:function(){$("#entDialogEdit .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>')},success:function(data,statusTxt){setTimeout(function(){if(statusTxt=="success"){if(debug){console.log("Loading content | External content loaded successfully!")}$("#entDialogEdit .dialog__overview").hide().html(data).fadeIn(900);$(".getgps").click(getGPS_Data)}if(statusTxt=="error"){if(debug){console.log("Loading content | Error: "+xhr.status+": "+xhr.statusText)}}},1e3)},error:function(){},complete:function(){}});var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}$("#"+DataDialog+" .dialog__overview").html("")}});dlg.toggle(dlg);return false}function deleteEnt(entID){if(debug){console.log("----------- fn deleteEnt -----------")}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_delete_ent.php",type:"POST",datatype:"json",data:{entID:entID},success:function(data){if(data.status=="delete_success"){$("#ent_"+data.data[0].id).remove();setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:5e3})},1e3)}},complete:function(){},error:function(){}});return false}function confirmDeleteEnt(event){event.preventDefault();if(debug){console.log("----------- fn confirmDeleteEnt -----------")}var entID=$(this).attr("data-id");bootbox.setLocale(envoWeb.envo_lang);bootbox.confirm({title:"Potvrzení o odstranění!",message:$(this).attr("data-confirm-delent"),className:"bootbox-confirm-del",animate:true,buttons:{confirm:{className:"btn-success"},cancel:{className:"btn-danger"}},callback:function(result){if(result==true){if(debug){console.log("Delete Entrance - ID: "+entID)}deleteEnt(entID)}}});return false}$("#addEnt").click({element:'input[name="addEnt"]'},openDialogNewEnt);$("#saveEnt").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #saveEnt click -----------")}var $this=$(this);var parent=$this.parents(":eq(3)").attr("id");var houseID=pageID;var street=$("#"+parent+" input[name=envo_entstreet]").val();var elevator=$("#"+parent+" input[name=envo_entelevator]:checked").val();var apartment=$("#"+parent+" input[name=envo_entapartment]").val();var gpslat=$("#"+parent+" input[name=envo_housegpslat]");var gpslatval=gpslat.val();var gpslng=$("#"+parent+" input[name=envo_housegpslng]");var gpslngval=gpslng.val();var katastr=$("#"+parent+" input[name=envo_houseikatastr]").val();if(debug){console.log("Save Entrance Click fn | Data => parentID - "+parent+" | houseID - "+houseID+" | street -  "+street+" | elevator - "+elevator+" | apartment - "+apartment+" | gpslat - "+gpslatval+" | gpslng - "+gpslngval+" | katastr - "+katastr)}if(gpslatval.length||gpslngval.length){$.ajax({type:"POST",url:"/plugins/intranet2/admin/ajax/int2_table_addnew_ent.php",datatype:"json",data:{houseID:houseID,street:street,elevator:elevator,apartment:apartment,gpslat:gpslatval,gpslng:gpslngval,katastr:katastr},success:function(data){if(data.status=="success"){var str=JSON.stringify(data);var result=JSON.parse(str);var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){dataID=data["id"];divdata+='<div class="box box-success"  id="ent_'+dataID+'">'+'<div class="box-header with-border"><h3 class="box-title">Vchod <span class="bold">'+data["street"]+"</span></h3></div>"+'<div class="box-body no-padding">'+'<div class="block">'+'<div class="block-content">'+'<div class="col-sm-6 p-3">'+'<table class="table table-hover table-condensed">'+'<caption style="caption-side: top;">'+'<span class="m-r-20"><strong>GPS - Koordináty</strong></span>'+""+"</caption>"+"<tbody>"+"<tr>"+'<th style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Latitude</strong>"+"</th>"+'<td style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslat"]+"</span>"+"</td>"+"</tr>"+"<tr>"+'<th style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Longitude</strong>"+"</th>"+'<td style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslng"]+"</span>"+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>"+'<div class="col-sm-6 p-3">'+""+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="box-footer">'+'<button type="button" class="btn btn-danger  float-right deleteEnt" data-confirm-delent="Jste si jistý, že chcete odstranit vchod <strong>'+data["street"]+'</strong>" data-toggle="tooltipEnvo" data-placement="bottom" title="Odstranit" data-id="'+dataID+'"><i class="fa fa-trash-o"></i> Odstranění vchodu</button>'+'<button type="button" id="editEnt" class="btn btn-default float-right m-r-20 editEnt" data-toggle="tooltipEnvo" data-placement="bottom" title="Editace" data-dialog="entDialogEdit" data-id="'+dataID+'"><i class="fa fa-edit"></i> Editace vchodu</button>'+"</div>"+"</div>"})}});var divalert=$("#entlist .alert.bg-info");if(divalert){divalert.parent().remove()}$("#entlist").prepend(divdata);$("#ent_"+dataID+" .editEnt").click(openDialogEditEnt);$("#ent_"+dataID+" .deleteEnt").click(confirmDeleteEnt);$this.attr("disabled",true);$("#ent_notify_add").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$this.attr("disabled",true);$("#ent_notify_add").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(){}})}else{gpslat.parent().addClass("has-error");gpslng.parent().addClass("has-error");if(debug){console.log("Save Ent Click fn | Error E01")}}});$(".editEnt").click(openDialogEditEnt);$("#udpateEnt").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #udpateEnt click -----------")}var $this=$(this);var parent=$this.parents(":eq(3)").attr("id");var entID=$("#"+parent+" input[name=envo_editentid]").val();var street=$("#"+parent+" input[name=envo_entstreet]").val();var elevator=$("#"+parent+" input[name=envo_entelevator]:checked").val();var apartment=$("#"+parent+" input[name=envo_entapartment]").val();var gpslat=$("#"+parent+" input[name=envo_housegpslat]");var gpslatval=gpslat.val();var gpslng=$("#"+parent+" input[name=envo_housegpslng]");var gpslngval=gpslng.val();var katastr=$("#"+parent+" input[name=envo_houseikatastr]").val();if(debug){console.log("Update Entrance Click fn | Data => parentID - "+parent+" | entID - "+entID+" | street -  "+street+" | elevator - "+elevator+" | apartment - "+apartment+" | gpslat - "+gpslatval+" | gpslng - "+gpslngval+" | katastr - "+katastr)}if(gpslatval.length||gpslngval.length){$.ajax({type:"POST",url:"/plugins/intranet2/admin/ajax/int2_table_update_ent.php",datatype:"json",data:{entID:entID,street:street,elevator:elevator,apartment:apartment,gpslat:gpslatval,gpslng:gpslngval,katastr:katastr},success:function(data){if(data.status=="update_success"){var str=JSON.stringify(data);var result=JSON.parse(str);var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Save Task Ent fn | Ajax -> Key data[id]: "+data["id"])}dataID=data["id"];divdata+='<div class="box-header with-border"><h3 class="box-title">Vchod <span class="bold">'+data["street"]+"</span></h3></div>"+'<div class="box-body no-padding">'+'<div class="block">'+'<div class="block-content">'+'<div class="col-sm-6 p-3">'+'<table class="table table-hover table-condensed">'+'<caption style="caption-side: top;">'+'<span class="m-r-20"><strong>GPS - Koordináty</strong></span>'+""+"</caption>"+"<tbody>"+"<tr>"+'<th style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Latitude</strong>"+"</th>"+'<td style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslat"]+"</span>"+"</td>"+"</tr>"+"<tr>"+'<th style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Longitude</strong>"+"</th>"+'<td style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslng"]+"</span>"+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>"+'<div class="col-sm-6 p-3">'+""+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="box-footer">'+'<button type="button" class="btn btn-danger  float-right deleteEnt" data-confirm-delent="Jste si jistý, že chcete odstranit vchod <strong>'+data["street"]+'</strong>" data-toggle="tooltipEnvo" data-placement="bottom" title="Odstranit" data-id="'+dataID+'"><i class="fa fa-trash-o"></i> Odstranění vchodu</button>'+'<button type="button" id="editEnt" class="btn btn-default float-right m-r-20 editEnt" data-toggle="tooltipEnvo" data-placement="bottom" title="Editace" data-dialog="entDialogEdit" data-id="'+dataID+'"><i class="fa fa-edit"></i> Editace vchodu</button>'+"</div>"})}});$("#ent_"+dataID).html(divdata);$("#ent_"+dataID+" .editEnt").click(openDialogEditEnt);$("#ent_"+dataID+" .deleteEnt").click(confirmDeleteEnt);$("#ent_notify_edit").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$("#ent_notify_edit").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(){}})}else{gpslat.parent().addClass("has-error");gpslng.parent().addClass("has-error");if(debug){console.log("Update Ent Click fn | Error E01")}}});$(".deleteEnt").click(confirmDeleteEnt)});$(function(){"use strict";$(".file-clear").click(function(){var parent=$(this).parents(":eq(1)").attr("id");$("#"+parent+" .file-filename").val("");$("#"+parent+" .file-clear").hide();$("#"+parent+" .file-input input:file").val("");$("#"+parent+" .file-input").css("border-radius","3px 0 0 3px");$("#"+parent+" .file-input-title").text("Vybrat Soubor")});$(".file-input input:file").change(function(){var parent=$(this).parents(":eq(2)").attr("id");var file=this.files[0];console.log($(this).val());if($(this).val()!=""){$("#"+parent+" .file-input").css("border-radius","0");$("#"+parent+" .file-input-title").text("Změnit");$("#"+parent+" .file-clear").show();$("#"+parent+" .file-filename").val(file.name)}else{$("#"+parent+" .file-filename").val("");$("#"+parent+" .file-clear").hide();$("#"+parent+" .file-input-title").text("Vybrat Soubor")}})});$(function(){"use strict";$("#uploadBtnDocu").on("click",function(event){event.preventDefault();if(debug){console.log("----------- fn #uploadBtnDocu click -----------")}var desc=$('input[name="envo_descdocu"]');var descval=desc.val();var file_data=$("#fileinput_doc").prop("files")[0];var folder_path=$('input[name="folderpath"]').val();var form_data=new FormData;form_data.append("file",file_data);form_data.append("folderpath",folder_path);form_data.append("houseID",pageID);form_data.append("description",descval);$(".has-error-text").remove();desc.parent().removeClass("has-error");if(descval.length){$("#docuoutput").hide();$("#docuprogress").show();$("#docupercent").html("0%");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_upload_docu.php",type:"POST",data:form_data,contentType:false,cache:false,processData:false,beforeSend:function(){},xhr:function(){var xhr=new window.XMLHttpRequest;xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var loaded=evt.loaded;var total=evt.total;var percent=loaded/total*100;var percentComplete=percent.toFixed(2)+"%";var byteRec=formatFileSize(loaded);var totalByte=formatFileSize(total);$("#docuprogressbar").css("width",percentComplete);$("#docupercent").html(percentComplete);$("#docubyterec").html(byteRec);$("#docubytetotal").html(totalByte)}},false);return xhr},success:function(data){if(data.status=="upload_success"){$("#docuoutput").html('<div class="alert alert-success" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Success: </strong>"+data.status_msg+"</div>");var str=JSON.stringify(data);var result=JSON.parse(str);var tabledata="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Upload File fn | Data => id - "+data["id"]+" | fsize -  "+data["fsize"]+" | ftime - "+data["ftime"]+" | ficon - "+data["ficon"]+" | description - "+data["description"]+" | fullpath - "+data["fullpath"])}tabledata+="<tr>"+'<td class="text-center">'+data["id"]+"</td>"+'<td class="text-center">'+data["ficon"]+"</td>"+"<td>"+data["description"]+"</td>"+'<td class="text-center"><a href="'+data["fullpath"]+'" target="_blank">Zobrazit</a> | <a href="'+data["fullpath"]+'" download>Stáhnout</a></td>'+"</tr>"})}});$("#tabledocu tbody").html(tabledata);desc.val("");$("#upload .file-filename").val("");$("#upload .file-clear").hide();$("#upload .file-input input:file").val("");$("#upload .file-input").css("border-radius","3px 0 0 3px");$("#upload .file-input-title").text("Vybrat Soubor");setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else if(data.status.indexOf("upload_error")!=-1){$("#docuoutput").html('<div class="alert alert-danger" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Error: </strong>"+data.status+" => "+data.status_msg+"</div>");setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}},error:function(){},complete:function(){$("#docuprogress").hide();$("#docuprogressbar").css("width","");$("#docuoutput").show()}})}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+"Zadejte popis souboru."},{type:"danger",delay:5e3})},1e3);desc.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:"absolute"},text:"Vyplňte označenou položku"}).appendTo(desc.parent())}})});$(function(){"use strict";function debounce(fn,threshold){var timeout;return function debounced(){if(timeout){clearTimeout(timeout)}function delayed(){fn();timeout=null}setTimeout(delayed,threshold||100)}}function openDialogEditImg(event){event.preventDefault();if(debug){console.log("----------- fn openDialogEditImg -----------")}var DataDialog=$(this).attr("data-dialog");var imageID=$(this).parents(":eq(4)").attr("id");var imageSuffixID=parseInt(/^.*\_(\d+)$/.exec(imageID)[1]);if(debug){console.log("Image ID from DIV: "+imageSuffixID)}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_dialog_img.php",type:"POST",datatype:"html",data:{imageID:imageSuffixID},beforeSend:function(){$("#imgDialogEdit .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>')},success:function(data){setTimeout(function(){$("#imgDialogEdit .dialog__overview").hide().html(data).fadeIn(900);$("#info1 .selectpicker").select2({minimumResultsForSearch:-1,dropdownParent:$(".page-content-wrapper"),dropdownCssClass:"zindex1060"})},1e3)},error:function(){}});var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}}});dlg.toggle(dlg);return false}function deleteImg(imageID){if(debug){console.log("----------- fn deleteImg -----------")}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_delete_img.php",type:"POST",datatype:"json",data:{imageID:imageID},success:function(data){if(data.status=="delete_success"){var $removeItem=$("#gallery_1_"+data.data[0].id);$gallery.isotope("remove",$removeItem).isotope("layout");$("#gallery_0_"+data.data[0].id).remove();setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:5e3})},1e3)}},complete:function(){},error:function(){}});return false}function confirmdeleteImg(event){event.preventDefault();if(debug){console.log("----------- fn confirmdeleteImg -----------")}var imageID=$(this).attr("data-id");bootbox.setLocale(envoWeb.envo_lang);bootbox.confirm({title:"Potvrzení o odstranění!",message:$(this).attr("data-confirm-delimg"),className:"bootbox-confirm-del",animate:true,buttons:{confirm:{className:"btn-success"},cancel:{className:"btn-danger"}},callback:function(result){if(result==true){if(debug){console.log("Delete Image - ID: "+imageID)}deleteImg(imageID)}}});return false}var qsRegex;var buttonFilter;var $gallery=$("#gallery_envo_1");$gallery.isotope({itemSelector:'div[class^="gallery-item-"]',masonry:{columnWidth:280,gutter:10,isFitWidth:true},filter:function(){var $this=$(this);var searchResult=qsRegex?$this.text().match(qsRegex):true;var buttonResult=buttonFilter?$this.is(buttonFilter):true;return searchResult&&buttonResult}});var $quicksearch=$("#quicksearch").keyup(debounce(function(){qsRegex=new RegExp($quicksearch.val(),"gi");$gallery.isotope()}));$("#imagefilters").on("click",".filter",function(event){event.preventDefault();var $this=$(this);buttonFilter=$(this).attr("data-filter");$gallery.isotope()});$("#imagefilters .filter").on("click",function(){$("#imagefilters").find(".active").removeClass("active");$(this).addClass("active")});$('a[href="#cmsPage10"]').on("shown.bs.tab",function(e){$gallery.isotope("layout")});$("#showPhotoList").on("click",function(e){$(this).removeClass("btn-info").addClass("btn-complete");$("#showFiltrPhoto").removeClass("btn-complete").addClass("btn-info");$("#list_photo").fadeIn(500);$("#isotope_photo").fadeOut(500)});$("#showFiltrPhoto").on("click",function(e){$(this).removeClass("btn-info").addClass("btn-complete");$("#showPhotoList").removeClass("btn-complete").addClass("btn-info");$("#isotope_photo").fadeIn(500);$("#list_photo").fadeOut(500);setTimeout(function(){$gallery.isotope("layout")},500)});$("#uploadBtnImg").on("click",function(event){event.preventDefault();if(debug){console.log("----------- fn #uploadBtnImg click -----------")}var desc=$('input[name="envo_descimg"]');var descval=desc.val();var cat=$('select[name="envo_imgcategory"]');var catval=cat.val();var file_data=$("#fileinput_img").prop("files")[0];var folder_path=$('input[name="folderpath"]').val();var imgcat=$('select[name="envo_imgcategory"]').val();var form_data=new FormData;form_data.append("file",file_data);form_data.append("folderpath",folder_path);form_data.append("houseID",pageID);form_data.append("imageCategory",imgcat);$(".has-error-text").remove();cat.parent().removeClass("has-error");desc.parent().removeClass("has-error");if(catval.length){if(descval.length){$("#imgoutput").hide();$("#imgprogress").show();$("#imgpercent").html("0%");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_upload_img.php",type:"POST",data:form_data,contentType:false,cache:false,processData:false,beforeSend:function(){},xhr:function(){var xhr=new window.XMLHttpRequest;xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var loaded=evt.loaded;var total=evt.total;var percent=loaded/total*100;var percentComplete=percent.toFixed(2)+"%";var byteRec=formatFileSize(loaded);var totalByte=formatFileSize(total);$("#imgprogressbar").css("width",percentComplete);$("#imgpercent").html(percentComplete);$("#imgbyterec").html(byteRec);$("#imgbytetotal").html(totalByte)}},false);return xhr},success:function(data){if(data.status=="upload_success"){$("#imgoutput").html('<div class="alert alert-success" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Success: </strong>"+data.status_msg+"</div>");var str=JSON.stringify(data);var result=JSON.parse(str);var divdata="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){var $isotopeContent=$(""+'<div id="gallery_1_'+data["id"]+'" class="gallery-item-'+data["id"]+" "+data["category"]+'" data-width="1" data-height="1">'+'<div class="img_container"><img src="'+data["filethumbpath"]+'" alt="" class="image-responsive-height"></div>'+'<div class="overlays full-width">'+'<div class="row full-height">'+'<div class="col-5 full-height">'+'<div class="text font-montserrat">'+data["filenamethumb"].substring(data["filenamethumb"].lastIndexOf(".")+1).toUpperCase()+"</div>"+"</div>"+'<div class="col-7 full-height">'+'<div class="text">'+'<a data-fancybox="gallery" href="'+data["filethumbpath"]+'">'+'<button class="btn btn-info btn-xs btn-mini mr-1 fs-14" type="button"><i class="pg-image"></i></button>'+"</a>"+'<button class="btn btn-info btn-xs btn-mini fs-14 dialog-open-img mr-1" type="button" data-dialog="imgDialogEdit"><i class="fa fa-edit"></i></button>'+'<button class="btn btn-info btn-xs btn-mini fs-14 delete-img" type="button" data-id="'+data["id"]+'"  data-confirm-delimg="Jste si jistý, že chcete odstranit obrázek?"><i class="fa fa-trash"></i></button>'+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="full-width padding-10">'+'<p class="bold">Krátký Popis</p><p class="shortdesc">'+data["shortdescription"]+"</p>"+"</div>"+"</div>");$gallery.prepend($isotopeContent).isotope("prepended",$isotopeContent);var elClass=$("#gallery_1_"+data["id"]+".gallery-item-"+data["id"]);elClass.find(".dialog-open-img").click(openDialogEditImg);elClass.find(".delete-img").click(confirmdeleteImg)})}});setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else if(data.status.indexOf("upload_error")!=-1){$("#imgoutput").html('<div class="alert alert-danger" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Error: </strong>"+data.status+" => "+data.status_msg+"</div>");setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}},error:function(){},complete:function(){$("#imgprogress").hide();$("#imgprogressbar").css("width","");$("#imgoutput").show()}})}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+"Zadejte popis souboru."},{type:"danger",delay:5e3})},1e3);desc.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:"absolute"},text:"Vyplňte označenou položku"}).appendTo(desc.parent())}}else{setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+"Vyberte kategorii."},{type:"danger",delay:5e3})},1e3);cat.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:"absolute"},text:"Vyplňte označenou položku"}).appendTo(cat.parent())}});$(".delete-img").click(confirmdeleteImg);$(".dialog-open-img").click(openDialogEditImg);$("#udpateImg").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #udpateImg click -----------")}var imageID=$("input[name=envo_editimgid]").val();var descImage=$("#desc").val();var shortdescImage=$("#shortdesc").val();var catImage=$('select[name="envo_imgcategory_dialog"]').val();$.ajax({type:"POST",url:"/plugins/intranet2/admin/ajax/int2_table_update_img.php",datatype:"json",data:{imageID:imageID,descImage:descImage,shortdescImage:shortdescImage,catImage:catImage},success:function(data){if(data.status=="update_success"){$("#timeedit").html(data.data[0].timeedit);var elClass0=$("#gallery_1_"+data.data[0].id+".gallery-item-"+data.data[0].id);elClass0.find(".shortdesc").text(data.data[0].shortdescription);var elClass1=$("#gallery_1_"+data.data[0].id).attr("class").split(" ")[0];$("#gallery_1_"+data.data[0].id+"."+elClass1).removeClass().addClass(elClass1+" "+data.data[0].category);$("#img_notify_edit").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$("#img_notify_edit").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(){}})})});$(function(){});