var debug=true;$.urlParam=function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);if(results==null){return null}else{return decodeURI(results[1])||0}};var pageID=$.urlParam("id");var page=$.urlParam("p");var page1=$.urlParam("sp");var page2=$.urlParam("ssp");if(debug){console.log("Jquery Parse URL | Data => pageID - "+pageID+" | page - "+page+" | page1 - "+page1+" | page2 - "+page2+"")}$wrapLimitRange={min:aceEditor.acewraplimit,max:aceEditor.acewraplimit};function aceboolean(param){if(param=="1"){return true}else{return false}}if($("#htmleditor").length){var htmlACE=ace.edit("htmleditor");htmlACE.setTheme("ace/theme/"+aceEditor.acetheme);htmlACE.session.setUseWrapMode(aceEditor.aceactivewrap);htmlACE.session.setWrapLimitRange($wrapLimitRange.min,$wrapLimitRange.max);htmlACE.setOptions({mode:"ace/mode/html_ruby",tabSize:aceEditor.acetabSize,useSoftTabs:true,indentedSoftWrap:false,highlightActiveLine:aceboolean(aceEditor.aceactiveline),showPrintMargin:false,fontSize:aceEditor.fontSize,showInvisibles:aceEditor.aceinvisible,showGutter:aceboolean(aceEditor.acegutter)});htmlACE.$blockScrolling=Infinity;var texthtml=$("#envo_editor").val();htmlACE.session.setValue(texthtml)}function getGPS_Data(event){event.preventDefault();if(debug){console.log("----------- fn getGPS_Data -----------")}if($("#saveEnt").length){$("#saveEnt").attr("disabled",true)}if($("#udpateEnt").length){$("#udpateEnt").attr("disabled",true)}var parent=$(this).parents(":eq(4)").attr("id");var street=$("#"+parent+' input[name="envo_entstreet"]').val();var streettrim=$.trim(street).replace(/\s/g,"+");var city=$('select[name="envo_housecity"]').find(":selected").data("city_name");var citytrim=$.trim(city).replace(/\s/g,"+");if(debug){console.log("GPS Click fn | Parent ID: "+parent);console.log("GPS Click fn | Adress: "+street+", "+city)}$.ajax({url:"/plugins/intranet2/admin/ajax/gpscoordinates_osm.php",type:"POST",dataType:"json",data:{street:streettrim,city:citytrim},cache:false,timeout:2e4,beforeSend:function(){$("#"+parent+" .loadingdata_gps").html("Načítání ... Prosím počkejte").css("visibility","visible");$("#"+parent+" .loadingdata_ikatastr").html("Načítání ... Prosím počkejte").css("visibility","visible")},success:function(data){if(jQuery.isEmptyObject(data)){if(debug){console.log("NO GPS DATA | Empty JSON Object")}$("#"+parent+" input[name=envo_housegpslat]").val("NO GPS DATA").css("background-color","#FCC");$("#"+parent+" input[name=envo_housegpslng]").val("NO GPS DATA").css("background-color","#FCC");$("#"+parent+" input[name=envo_houseikatastr]").val("NO GPS DATA").css("background-color","#FCC")}else{var str=JSON.stringify(data);var result=JSON.parse(str);var wgslat=data["data"].lat;var wgslon=data["data"].lon;if(debug){console.log("GPS Coordinates - Latitude: "+wgslat+" / Longitude: "+wgslon)}var ikatastr="https://www.ikatastr.cz/#kde="+wgslat+","+wgslon+",19&mapa=osm&vrstvy=parcelybudovy&info="+wgslat+","+wgslon;$("#"+parent+" input[name=envo_housegpslat]").val(wgslat).css("background-color","#FFF5CC");$("#"+parent+" input[name=envo_housegpslng]").val(wgslon).css("background-color","#FFF5CC");$("#"+parent+" input[name=envo_houseikatastr]").val(ikatastr).css("background-color","#FFF5CC");setTimeout(function(){$("#"+parent+" input[name=envo_housegpslat]").css("background-color","#FFF");$("#"+parent+" input[name=envo_housegpslng]").css("background-color","#FFF");$("#"+parent+" input[name=envo_houseikatastr]").css("background-color","#FFF")},8e3);$("#"+parent+" .gps_link a.mapycz").attr("href","http://www.mapy.cz/#q="+wgslat+"%2C"+wgslon);$("#"+parent+" .gps_link a.openstreet").attr("href","https://www.openstreetmap.org/?mlat="+wgslat+"&mlon="+wgslon+"&zoom=16#map=18/"+wgslat+"/"+wgslon);$("#"+parent+" .ikatastrlink a.ikatastr").attr("href",ikatastr);$("#"+parent+" .gps_link").show()}setTimeout(function(){$("#"+parent+" .loadingdata_gps").html("").css("visibility","hidden");$("#"+parent+" .loadingdata_ikatastr").html("").css("visibility","hidden");if($("#saveEnt").length){$("#saveEnt").attr("disabled",false)}if($("#udpateEnt").length){$("#udpateEnt").attr("disabled",false)}},1e3)},error:function(jqXHR,textStatus,errorThrown){setTimeout(function(){$("#"+parent+" .loadingdata_gps").html("").css("visibility","hidden");$("#"+parent+" .loadingdata_ikatastr").html("").css("visibility","hidden")},1e3);if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})}function msToTime(s){function pad(n,z){z=z||2;return("00"+n).slice(-z)}var ms=s%1e3;s=(s-ms)/1e3;var secs=s%60;s=(s-secs)/60;var mins=s%60;var hrs=(s-mins)/60;return pad(mins)+":"+pad(secs)+"."+pad(ms,3)}function initializeTinyMce(selector,height){if(selector==undefined){selector="textarea"}if($(selector).length){tinymce.init({selector:selector,theme:"modern",width:"100%",height:height,language:envoWeb.envo_lang,content_style:".mce-content-body {font-size:12px;}",entity_encoding:"raw",plugins:["advlist autolink link charmap hr insertdatetime textcolor responsivefilemanager","searchreplace visualblocks paste","table"],paste_as_text:true,menubar:"edit insert view format table",toolbar:"undo redo | bold italic | alignleft aligncenter alignjustify | bullist numlist | forecolor backcolor",statusbar:false,valid_elements:"*[*]",insertdatetime_formats:["%H:%M:%S","%Y-%m-%d","%d.%m.%Y","%I:%M:%S %p","%D"],external_filemanager_path:"/assets/plugins/tinymce/plugins/filemanager/",filemanager_title:"Filemanager",external_plugins:{filemanager:"plugins/filemanager/plugin.min.js"}})}}function initializeDateTimePicker(selector){$(selector).datetimepicker({locale:envoWeb.envo_lang,format:"DD.MM.YYYY",icons:$.AdminEnvo.DateTimepicker.icons(),tooltips:$.AdminEnvo.DateTimepicker.tooltips(),showTodayButton:true,showClear:true,calendarWeeks:true,ignoreReadonly:true})}function formatFileSize(bytes){if(typeof bytes!=="number"){return""}if(bytes>=1e9){return(bytes/1e9).toFixed(2)+" GB"}if(bytes>=1e6){return(bytes/1e6).toFixed(2)+" MB"}return(bytes/1e3).toFixed(2)+" KB"}function copyToClipboard(element){var temp=$("<input>");$("body").append(temp);temp.val($(element).val()).select();document.execCommand("copy");temp.remove()}var urlExists=function(url,callback){if(!$.isFunction(callback)){throw Error("Not a valid callback")}$.ajax({type:"HEAD",url:url,success:$.proxy(callback,this,true),error:$.proxy(callback,this,false)})};$(function(){"use strict";if(page2!=null&&page1!="search_db"){initializeTinyMce("textarea.envoEditorLarge","200")}});$(function(){"use strict";$('input[name="envo_houseic"]').on("keyup keypress input paste change",function(){var getic=$.trim($(this).val()).replace(/\s/g,"");$("#ares_res a:first").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_res.cgi?ico="+getic+"&jazyk=cz&xml=1");$("#ares_res a:last-child").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_vreo.cgi?ico="+getic+"&jazyk=cz&xml=1");$("#justice_vor a").attr("href","https://or.justice.cz/ias/ui/rejstrik-$firma?ico="+getic+"&jenPlatne=VSECHNY")});$('input[name="envo_houseares"]').change(function(){if(this.value=="1"){$("#ares_res").show()}else if(this.value=="0"){$("#ares_res").hide()}});$('input[name="envo_housejustice"]').change(function(){if(this.value=="1"){$("#justice_vor").show()}else if(this.value=="0"){$("#justice_vor").hide()}});$(".getgps").click(getGPS_Data);$("input[name=envo_houseikatastr]").keyup(function(){var parent=$(this).parents(":eq(4)").attr("id");var getkatastr=$.trim($(this).val()).replace(/\s/g,"");if($(this).val().length>0){$("#"+parent+" .ikatastrlink a").attr("href",getkatastr)}else{$("#"+parent+" .ikatastrlink a").attr("href","https://www.ikatastr.cz/")}if(debug){console.log("Katastr Keyup fn | Parent ID: "+parent+" | Text: "+getkatastr)}});$("#loadAres").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #loadAres click -----------")}var ic=$.trim($('input[name="envo_dataares"]').val()).replace(/\s/g,"");var ajaxTime=(new Date).getTime();$.ajax({url:"/plugins/intranet2/admin/ajax/ares.php",type:"POST",dataType:"json",data:{ic:ic},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){if(data.status=="upload_success"){if(debug){console.log("ID města: "+""+data.mesto_id)}var divdata="";divdata+='<div class="col-sm-12"><h5>Získaná data z databáze Ares</h5><hr>'+"<p><strong>"+data.status_msg+"</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime">'+totalTime+"</span></p><hr>"+'<table class="table">'+"<tbody>"+'<tr class="row">'+'<th style="border-top: none;border-bottom: 1px solid #DEE2E6;" class="col-sm-4">Název</th>'+'<td class="col-sm-8">'+data.name+"</td>"+"</tr>"+'<tr class="row">'+'<th style="border-top: none;border-bottom: 1px solid #DEE2E6;" class="col-sm-4">Katastrální území</th>'+'<td class="col-sm-8">'+data.katastralniuzemi+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>";$("#outputaresdate").html("").prepend(divdata).show();$("input[name=envo_housename]").val("SVJ domu ");$("input[name=envo_househeadquarters]").val(data.ulice+", "+data.mesto+" - "+data.katastralniuzemi+", PSČ "+data.psc).css("background-color","#FFF5CC");$("input[name=envo_houseic]").val(data.ic).css("background-color","#FFF5CC");$("input[name=envo_housestreet]").val(data.ulice).css("background-color","#FFF5CC");$('select[name="envo_housecity"]').val(data.mesto_id);$('select[name="envo_housecity"] + span span.select2-selection').css("background-color","#FFF5CC");$("input[name=envo_housepsc]").val(data.psc).css("background-color","#FFF5CC");if($("input[name=envo_housefname]").length){$("input[name=envo_housefname]").val(data.name).css("background-color","#FFF5CC")}if($("input[name=envo_housefstreet]").length){$("input[name=envo_housefstreet]").val(data.ulice).css("background-color","#FFF5CC")}if($("input[name=envo_housefcity]").length){$("input[name=envo_housefcity]").val(data.mesto).css("background-color","#FFF5CC")}if($("input[name=envo_housefpsc]").length){$("input[name=envo_housefpsc]").val(data.psc).css("background-color","#FFF5CC")}if($("input[name=envo_housefic]").length){$("input[name=envo_housefic]").val(data.ic).css("background-color","#FFF5CC")}if($("input[name=envo_housefdic]").length){$("input[name=envo_housefdic]").val(data.dic).css("background-color","#FFF5CC")}setTimeout(function(){var array=["input[name=envo_househeadquarters]","input[name=envo_housestreet]",'select[name="envo_housecity"] + span span.select2-selection',"input[name=envo_housepsc]","input[name=envo_houseic]","input[name=envo_housefname]","input[name=envo_housefstreet]","input[name=envo_housefcity]","input[name=envo_housefpsc]","input[name=envo_housefic]","input[name=envo_housefdic]"];var element=$(array.join(", "));element.css({"background-color":"#FFF"})},8e3);$("#ares_res a:first").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_res.cgi?ico="+ic+"&jazyk=cz&xml=1");$("#ares_res a:last-child").attr("href","https://wwwinfo.mfcr.cz/cgi-bin/ares/darv_vreo.cgi?ico="+ic+"&jazyk=cz&xml=1");$("#justice_vor a").attr("href","https://or.justice.cz/ias/ui/rejstrik-$firma?ico="+ic+"&jenPlatne=VSECHNY");$('input[name=envo_houseares][value="1"]').prop("checked",true);$('input[name=envo_housejustice][value="1"]').prop("checked",true);$("#ares_res,#justice_vor").show();$("select[name=envo_housecity]").trigger("change");var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));$("#ajaxTime").html(totalTime);if(debug){console.log("ajaxTime | Success Time: "+totalTime);console.log($('select[name="envo_housecity"]').find(":selected").data("city_name"))}$("#loadingdata").hide().html("")}else{var divdata="";divdata+='<div class="col-sm-12"><h5>Výstup z Ares</h5>'+'<p style="color: #C10000;"><i class="fa fa-exclamation"></i> <strong>'+data.status_msg+"</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime">'+totalTime+"</span></p><hr>"+"<p>"+data.status_info+"</p>"+"</div>";$("#outputaresdate").html("").prepend(divdata).show();var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("");setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}},error:function(jqXHR,textStatus,errorThrown){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;color: #C10000;font-weight: 700;">Vypršel časový limit pro komunikaci se serverem Ares</span><span style="float: left;width: 100%;color: #C10000;font-weight: 700;">Server Ares neodpovídá -> obnovte stránku a zkuste hledání později!</span><button type="button" class="btn btn-success mt-2" onClick="window.location.reload()">Obnovit stránku</button></div></div>');if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}if(textStatus==="timeout"){if(debug)console.log("Timeout: "+textStatus+": "+errorThrown)}else{if(debug)console.log(textStatus+": "+errorThrown)}},complete:function(){}})});$("#loadCuzk").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #loadCuzk click -----------")}var street=$('input[name="envo_housestreet"]').val();var streettrim=$.trim(street).replace(/\s/g,"+");var city=$('select[name="envo_housecity"]').find(":selected").data("city_name");var citytrim=$.trim(city).replace(/\s/g,"+");var converter=new JTSK_Converter;var ajaxTime=(new Date).getTime();$.ajax({url:"/plugins/intranet2/admin/ajax/gpscoordinates_osm.php",type:"POST",dataType:"json",data:{street:streettrim,city:citytrim},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ČÚZK</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);var wgslat=data["data"].lat;var wgslon=data["data"].lon;if(debug){console.log("GPS Coordinates - Latitude: "+wgslat+" / Longitude: "+wgslon)}var jtsk=converter.WGS84toJTSK(wgslat,wgslon);var strX=jtsk.y;var substrX=strX.toFixed(2);var x=substrX.split(".")[0];var strY=jtsk.x;var substrY=strY.toFixed(2);var y=substrY.split(".")[0];if(debug){console.log(jtsk);console.log("WGS84.lat: "+wgslat);console.log("WGS84.lon: "+wgslon);console.log("JTSK.x: "+jtsk.y);console.log("JTSK.y: "+jtsk.x);console.log("WGS84.lat -> JTSK.x: "+substrX);console.log("WGS84.lon -> JTSK.y: "+substrY)}$.ajax({url:"/plugins/intranet2/admin/ajax/cuzk.php",type:"POST",dataType:"html",data:{x:x,y:y,street:street,city:city},cache:false,success:function(data){var ku_obec=$(data).find("#ku_obec").text();var ku_ncode=$(data).find("#ku_name_code").text();if(debug){console.log("Finding Data | KU Obec: "+ku_obec+"| KU Katastrální území: "+ku_ncode)}var ku_code1=ku_obec.match(/\d+/);var ku_code2=ku_ncode.match(/\d+/);if(debug){console.log("KU Data | KU Kód Obce: "+ku_code1+" | KU Kód Katastrálního území: "+ku_code2)}$("#outputajaxdata_katastr").html("").prepend(data).show();$('select[name="envo_house_cuzk_city"] option[data-city_cuzk_code="'+ku_code1+'"]').attr("selected","selected");$('select[name="envo_house_cuzk_city"] + span span.select2-selection').css("background-color","#FFF5CC");$('select[name="envo_house_cuzk_ku"] option[data-ku_cuzk_code="'+ku_code2+'"]').attr("selected","selected");$('select[name="envo_house_cuzk_ku"] + span span.select2-selection').css("background-color","#FFF5CC");$("select[name=envo_house_cuzk_city]").trigger("change");$("select[name=envo_house_cuzk_ku]").trigger("change");setTimeout(function(){$('select[name="envo_house_cuzk_city"] + span span.select2-selection').css("background-color","#FFF");$('select[name="envo_house_cuzk_ku"] + span span.select2-selection').css("background-color","#FFF")},8e3);var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));$("#ajaxTime_katastr").html(totalTime);if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("")},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});return false});$("#loadObjCode").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #loadObjCode click -----------")}var street=$('input[name="envo_housestreet"]').val();var streettrim=$.trim(street).replace(/\s/g,"+");var city=$('select[name="envo_housecity"]').find(":selected").data("city_name");var citytrim=$.trim(city).replace(/\s/g,"+");var converter=new JTSK_Converter;var ajaxTime=(new Date).getTime();if(debug){console.log("Data from FORM => street:"+streettrim+" | city: "+citytrim)}$.ajax({url:"/plugins/intranet2/admin/ajax/gpscoordinates_osm.php",type:"POST",dataType:"json",data:{street:streettrim,city:citytrim},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ČÚZK</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);var wgslat=data["data"].lat;var wgslon=data["data"].lon;if(debug){console.log("GPS Coordinates - Latitude: "+wgslat+" / Longitude: "+wgslon)}var jtsk=converter.WGS84toJTSK(wgslat,wgslon);var strX=jtsk.y;var substrX=strX.toFixed(2);var x=substrX.split(".")[0];var strY=jtsk.x;var substrY=strY.toFixed(2);var y=substrY.split(".")[0];if(debug){console.log(jtsk);console.log("WGS84.lat: "+wgslat);console.log("WGS84.lon: "+wgslon);console.log("JTSK.x: "+jtsk.y);console.log("JTSK.y: "+jtsk.x);console.log("WGS84.lat -> JTSK.x: "+substrX);console.log("WGS84.lon -> JTSK.y: "+substrY)}$.ajax({url:"https://services.cuzk.cz/wfs/inspire-ad-wfs.asp?service=WFS&version=2.0.0&request=GetFeature&StoredQuery_id=GetFeatureByPoint&srsName=urn:ogc:def:crs:EPSG::4326&POINT="+wgslat+","+wgslon+"&FEATURE_TYPE=Address",type:"POST",dataType:"xml",cache:false,success:function(data){var adId=data.getElementsByTagName("base:localId")[0];var adIdtxt=adId.innerHTML;if(debug){console.log("adId: "+adIdtxt);console.log("Links: http://vdp.cuzk.cz/vdp/ruian/adresnimista/"+adIdtxt.split(".")[1])}},error:function(){},complete:function(){}});$.ajax({url:"https://services.cuzk.cz/wfs/inspire-cp-wfs.asp?service=WFS&version=2.0.0&request=GetFeature&StoredQuery_id=GetFeatureByPoint&srsName=urn:ogc:def:crs:EPSG::4326&POINT="+wgslat+","+wgslon+"&FEATURE_TYPE=CadastralParcel",type:"POST",dataType:"xml",cache:false,success:function(data){},error:function(){},complete:function(){}});$.ajax({url:"https://services.cuzk.cz/wfs/inspire-bu-wfs.asp?service=WFS&version=2.0.0&request=GetFeature&StoredQuery_id=GetFeatureByPoint&srsName=urn:ogc:def:crs:EPSG::4326&POINT="+wgslat+","+wgslon+"&FEATURE_TYPE=Building",type:"POST",dataType:"xml",cache:false,success:function(data){var buId=data.getElementsByTagName("base:localId")[0];var name=data.getElementsByTagName("bu-base:name")[0];name&&(name=(name=name.getElementsByTagName("gn:text"))?name[0].textContent:null);var buVdpId=data.getElementsByTagName("bu-base:reference")[0].textContent;if(debug){console.log("buId: "+buId.innerHTML);console.log("buTag: "+name);console.log("buVdpId: "+buVdpId)}var divdata="";divdata+='<div  class="col-sm-12">'+"<h5>Získaná data z databáze ČÚZK dle adresy sídla</h5><hr>"+"<p><strong>ČÚZK: GPS data byla nalezena a data byla stažena</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime_katastr">'+totalTime+"</span></p><hr>"+"<p>Vybraná adresa pro vyhledání dat: "+street+", "+city+"</p><hr>"+"<p><strong>buId: </strong> "+buId.innerHTML+"</p>"+'<p><strong style="color: #C10000;">Kód objektu (buVdpId): </strong> '+buVdpId+"</p>"+"<p><strong>Stavba na pozemku (buTag): </strong> "+name+"</p>"+'<p><strong>Detail stavebního objektu: </strong><a href="http://vdp.cuzk.cz/vdp/ruian/stavebniobjekty/'+buVdpId+'" target="WindowCUZK">Zobrazit detail objektu na ČÚZK</a></p><hr>'+"</div>";$("#outputajaxdata_katastr").html("").prepend(divdata).show();$('input[name="envo_house_cuzk_objcode"]').val(buVdpId).css("background-color","#FFF5CC");$("#cuzk_objdetail_link").html("");$("<a/>",{href:"http://vdp.cuzk.cz/vdp/ruian/stavebniobjekty/"+buVdpId,text:"Zobrazit detail objektu",target:"WindowCUZK"}).appendTo($("#cuzk_objdetail_link"));setTimeout(function(){$('input[name="envo_house_cuzk_objcode"]').css("background-color","#FFF")},8e3);var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));$("#ajaxTime_katastr").html(totalTime);if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("")},error:function(jqXHR,textStatus,errorThrown){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ČÚZK</span><span style="float: left;width: 100%;margin-bottom: 10px;color: #C10000;font-weight: 700;">Vypršel časový limit pro komunikaci se serverem ČÚZK</span><span style="color: #C10000; font-weight: 700;">Server ČÚZK neodpovídá -> obnovte stránku a zkuste hledání později!</span></div></div>');if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}if(textStatus==="timeout"){if(debug)console.log("Timeout: "+textStatus+": "+errorThrown)}else{if(debug)console.log(textStatus+": "+errorThrown)}},complete:function(){}})},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})});$("#loadIkatastr").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #loadIkatastr click -----------")}var street=$('input[name="envo_housestreet"]').val();var streettrim=$.trim(street).replace(/\s/g,"+");var city=$('select[name="envo_housecity"]').find(":selected").data("city_name");var citytrim=$.trim(city).replace(/\s/g,"+");var ajaxTime=(new Date).getTime();$.ajax({url:"/plugins/intranet2/admin/ajax/gpscoordinates_osm.php",type:"POST",dataType:"json",data:{street:streettrim,city:citytrim},cache:false,timeout:2e4,success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);var wgslat=data["data"].lat;var wgslon=data["data"].lon;if(debug){console.log("GPS Coordinates - Latitude: "+wgslat+" / Longitude: "+wgslon)}var ikatastr="https://www.ikatastr.cz/#kde="+wgslat+","+wgslon+",19&mapa=osm&vrstvy=parcelybudovy&info="+wgslat+","+wgslon;var divdata="";divdata+='<div  class="col-sm-12">'+"<h5>iKatastr - Link</h5><hr>"+'<p>Doba zpracování požadavku: <span id="ajaxTime_katastr">'+totalTime+"</span></p><hr>"+"<p>Vybraná adresa pro vyhledání dat: "+street+", "+city+"</p><hr>"+'<p><a href="'+ikatastr+'" target="WindowKATASTR">Zobrazit informace z Katastru</a></p><hr>'+"</div>";$("#outputajaxdata_katastr").html("").prepend(divdata).show();var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));$("#ajaxTime_katastr").html(totalTime);if(debug){console.log("ajaxTime | Success Time: "+totalTime)}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})});$("#loadStatistic").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #loadStatistic click -----------")}var objcode=$.trim($('input[name="envo_house_cuzk_objcode"]').val()).replace(/\s/g,"+");var ajaxTime=(new Date).getTime();$.ajax({url:"/plugins/intranet2/admin/ajax/statistics.php",type:"POST",dataType:"html",data:{objcode:objcode},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">STATISTIKA</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){$("#outputajaxdata_statistics").html("").prepend(data).show();var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));$("#ajaxTime_statistics").html(totalTime);if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("");$(".123456").each(function(){var value=$(this).data("val");var valueupl=$(this).data("val-upl");var element=$(this).data("el");var elementname=$(this).data("el-name");var targetel=$(element+'[name="'+elementname+'"]');var targetelupl=$('input[name="'+elementname+'_upl"]');targetelupl.val(valueupl);if(element=="select"){$('select[name="'+elementname+'"]').val(value);$('select[name="'+elementname+'"] + span span.select2-selection').css("background-color","#FFF5CC");$('select[name="'+elementname+'"]').trigger("change");setTimeout(function(){$('select[name="'+elementname+'"] + span span.select2-selection').css("background-color","#FFF")},8e3)}else{$('input[name="'+elementname+'"]').val(value).css("background-color","#FFF5CC");setTimeout(function(){$('input[name="'+elementname+'"]').css("background-color","#FFF")},8e3)}})},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})});$("#testgps").click(function(e){e.preventDefault();if(debug){console.log("----------- fn #testgps click -----------")}var street=$.trim($('input[name="envo_housestreet"]').val()).replace(/\s/g,"+");var city=$.trim($('select[name="envo_housecity"]').find(":selected").data("city_name")).replace(/\s/g,"+");var ajaxTime=(new Date).getTime();$.ajax({url:"/plugins/intranet2/admin/ajax/gpscoordinates_osm.php",type:"POST",dataType:"json",data:{street:street,city:city},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">GPS</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("")},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})})});$(function(){"use strict";initializeDateTimePicker("#datepickerTime")});$(function(){"use strict";var table=$("#int2_table");if(table.length){table.DataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Czech.json"},order:[],columnDefs:[{targets:"no-sort",orderable:false}],pageLength:dataTablesSettings.pageLenght,dom:"<'row'<'col-sm-6'<'float-left m-b-20'f>><'col-sm-6'<'float-right m-r-20 hidden-xs'B>>>"+"<'row'<'col-sm-12'tr>>"+"<'row '<'col-sm-7'i><'float-right col-sm-5'p>>",mark:true})}});$(function(){"use strict";$("#envo_delete_all").click(function(){var checkedStatus=this.checked;if(checkedStatus){$("#button_delete").prop("disabled",false)}else{$("#button_delete").attr("disabled",true)}$(".highlight").each(function(){$(this).prop("checked",checkedStatus)})});$(".highlight").change(function(){if(this.checked){$("#button_delete").prop("disabled",false)}else{if($(".highlight").filter(":checked").length<1){$("#envo_delete_all").prop("checked",false);$("#button_delete").attr("disabled",true)}}})});$(function(){"use strict";function selecthouse(event){event.preventDefault();var valID=$(this).attr("data-value");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_houseselect_process.php",type:"POST",datatype:"json",data:{valID:valID},success:function(data){var res=$.parseJSON(data);$('input[name="envo_housename"]').val(res.name);$('input[name="envo_househeadquarters"]').val(res.headquarters);$('input[name="envo_housestreet"]').val(res.street);$('select[name="envo_housecity"]').val(res.city);$('input[name="envo_housepsc"]').val(res.psc);$('input[name="envo_houseic"]').val(res.ic);$('input[name="envo_dataares"]').val(res.ic);$('input[name="envo_housefname"]').val(res.housefname);$('input[name="envo_housefstreet"]').val(res.housefstreet);$('input[name="envo_housefcity"]').val(res.housefcity);$('input[name="envo_housefpsc"]').val(res.housefpsc);$('input[name="envo_housefic"]').val(res.housefic);$('input[name="envo_housefdic"]').val(res.housefdic);$('select[name="envo_estatemanagement"]').val(res.estatemanagement);var array=["select[name=envo_housecity]","select[name=envo_estatemanagement]"];var element=$(array.join(", "));element.trigger("change");$("#ENVOModalPlugin").modal("hide")},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});return false}$("#houseSelect").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #houseSelect click -----------")}var altura=$(window).height()-155;$("#ENVOModalPlugin .modal-body").css({height:altura,"overflow-y":"auto"});$.ajax({url:"/plugins/intranet2/admin/ajax/int2_houseselect_modal.php",type:"POST",dataType:"html",beforeSend:function(){$("#ENVOModalPlugin .modal-body").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>');$("#ENVOModalPlugin").modal("show")},success:function(data){setTimeout(function(){$("#ENVOModalPlugin .modal-body").hide().html(data).fadeIn(900);$(".selecthouse").click(selecthouse);$("#int_table").dataTable({language:{url:"//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Czech.json"},order:[],columnDefs:[{targets:"no-sort",orderable:false}],pageLength:dataTablesSettings.pageLenght,dom:"<'row'<'col-sm-6'<'float-left m-b-20'f>><'col-sm-6'<'float-right m-r-20 hidden-xs'B>>>"+"<'row'<'col-sm-12'tr>>"+"<'row '<'col-sm-7'i><'float-right col-sm-5'p>>"})},1e3)},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})})});$(function(){"use strict";$(".copyadress").click(function(e){e.preventDefault();if(debug){console.log("----------- fn .copyadress click -----------")}var street1=$("input[name=envo_housestreet]").val();if($("input[name=envo_entstreet]").length){var street2=$("input[name=envo_entstreet]").val()}else{var street2=""}var city=$('select[name="envo_housecity"]').find(":selected").data("city_name");if(street2.length>0){var adress=street2+", "+city}else{var adress=street1+", "+city}if(debug){console.log("Copyadress Click fn | Adress: "+adress)}var dummy=document.createElement("input");document.body.appendChild(dummy);dummy.setAttribute("id","dummy_id");document.getElementById("dummy_id").value=adress;dummy.select();document.execCommand("copy");document.body.removeChild(dummy)})});$(function(){"use strict";function clickTaskHeader(){if(debug){console.log("----------- fn clickTaskHeader -----------")}var header=$(this);var text=header.children("span.collapsetask");var content=header.next().next();content.slideToggle(500,function(){text.text(function(){return content.is(":visible")?"-":"+"})})}function openDialogNewTask(event){event.preventDefault();if(debug){console.log("----------- fn openDialogNewTask -----------")}var DataDialog=$(this).attr("data-dialog");var houseID=pageID;if(debug){console.log("Add New Task Click fn | Dialog ID: "+DataDialog)}$("#"+DataDialog+" .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>');setTimeout(function(){$("#"+DataDialog+" .dialog__overview").load("/plugins/intranet2/admin/ajax/content_new_task.php",function(responseTxt,statusTxt,xhr){if(statusTxt=="success"){if(debug){console.log("Loading content | External content loaded successfully!")}try{tinymce.remove("textarea.envoEditorSmall")}catch(e){}initializeTinyMce("textarea.envoEditorSmall",300);$("#"+DataDialog+" .selectpicker").select2({minimumResultsForSearch:-1,dropdownParent:$(".page-content-wrapper"),dropdownCssClass:"zindex1060"});initializeDateTimePicker("input[name=envo_addtasktime]");initializeDateTimePicker("input[name=envo_addtaskreminder]")}if(statusTxt=="error"){if(debug){console.log("Loading content | Error: "+xhr.status+": "+xhr.statusText)}}})},1e3);var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}$("#"+DataDialog+" .dialog__overview").html("");$("#saveTask").attr("disabled",false)}});dlg.toggle(dlg);return false}function openDialogEditTask(event){event.preventDefault();if(debug){console.log("----------- fn openDialogEditTask -----------")}var DataDialog=$(this).attr("data-dialog");var taskID=$(this).attr("data-id");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_dialog_task.php",type:"POST",datatype:"html",data:{taskID:taskID},beforeSend:function(){$("#"+DataDialog+" .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>')},success:function(data){setTimeout(function(){$("#"+DataDialog+" .dialog__overview").hide().html(data).fadeIn(900);try{tinymce.remove("textarea.envoEditorSmall")}catch(e){}initializeTinyMce("textarea.envoEditorSmall",300);$("#"+DataDialog+" .selectpicker").select2({minimumResultsForSearch:-1,dropdownParent:$(".page-content-wrapper"),dropdownCssClass:"zindex1060"});initializeDateTimePicker("input[name=envo_edittasktime]");initializeDateTimePicker("input[name=envo_edittaskreminder]")},1e3)},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}$("#"+DataDialog+" .dialog__overview").html("")}});dlg.toggle(dlg);return false}function deleteTask(taskID){if(debug){console.log("----------- fn deleteTask -----------")}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_delete_task.php",type:"POST",datatype:"json",data:{taskID:taskID},success:function(data){if(data.status=="delete_success"){$("#task_"+data.data[0].id).remove();setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:5e3})},1e3)}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});return false}function confirmDeleteTask(event){event.preventDefault();if(debug){console.log("----------- fn confirmDeleteTask -----------")}var taskID=$(this).attr("data-id");bootbox.setLocale(envoWeb.envo_lang);bootbox.confirm({title:"Potvrzení o odstranění!",message:$(this).attr("data-confirm-deltask"),className:"bootbox-confirm-del",animate:true,buttons:{confirm:{className:"btn-success"},cancel:{className:"btn-danger"}},callback:function(result){if(result==true){if(debug){console.log("Delete Task - ID: "+taskID)}deleteTask(taskID)}}});return false}$(".taskheader").click(clickTaskHeader);$("#addTask").click(openDialogNewTask);$("#saveTask").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #saveTask click -----------")}var $this=$(this);var houseID=pageID;var priority=$("select[name=envo_addtaskpriority]").val();var status=$("select[name=envo_addtaskstatus]").val();var title=$("input[name=envo_addtasktitle]").val();var description=tinymce.get("envoEditorSmall").getContent();var reminder=$("input[name=envo_addtaskreminder]");var reminderval=reminder.val();var time=$("input[name=envo_addtasktime]");var timeval=time.val();if(debug){console.log("Save Task Click fn | Data => houseID - "+houseID+" | priority -  "+priority+" | status - "+status+" | title - "+title+" | description - "+description+" | reminderval - "+reminderval+" | timeval - "+timeval)}if(timeval.length){if(reminderval.length){$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_addnew_task.php",type:"POST",datatype:"json",data:{houseID:houseID,priority:priority,status:status,title:title,description:description,reminder:reminderval,time:timeval},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);if(data.status=="success"){var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Save Task Click fn | Ajax -> Key data[id]: "+data["id"])}dataID=data["id"];divdata+='<div id="task_'+data["id"]+'" class="task_'+data["id"]+'">'+'<div class="taskheader bg-teal-600"><span>Task ID '+data["id"]+'</span><span class="float-right collapsetask">+</span></div>'+'<div class="taskinfo">'+'<div class="table-responsive">'+'<table class="table table-task">'+"<thead>"+"<tr>"+"<th>Titulek</th>"+"<th>Priorita</th>"+"<th>Status</th>"+"<th>Datum Úkolu</th>"+"<th>Datum Připomenutí</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+"<tr>"+"<td>"+data["title"]+"</td>"+"<td>"+data["priority"]+"</td>"+"<td>"+data["status"]+"</td>"+"<td>"+data["time"]+"</td>"+"<td>"+data["reminder"]+"</td>"+'<td class="text-center"><button type="button" id="editTask" class="btn btn-default btn-xs m-r-20 editTask" data-toggle="tooltipEnvo" title="" data-dialog="taskDialogEdit" data-original-title="Editovat" data-id="'+data["id"]+'"><i class="fa fa-edit"></i></button>'+'<button type="button" class="btn btn-danger btn-xs deleteTask" data-confirm-deltask="Jste si jistý, že chcete odstranit úkol <strong>'+data["title"]+'</strong>" data-toggle="tooltipEnvo" title="Odstranit" data-id="'+data["id"]+'"><i class="fa fa-trash-o"></i></button></td>'+"</tr>"+"</tbody>"+"</table>"+"</div>"+"</div>"+'<div class="taskcontent">'+"<p><strong >Popis Úkolu:</strong></p>"+'<div class="taskdescription">'+data["description"]+"</div>"+"</div>"+"</div>"})}});var divalert=$("#tasklist .alert.bg-info");if(divalert){divalert.parent().remove()}$("#tasklist").prepend(divdata);$("#task_"+dataID+" .taskheader").click(clickTaskHeader);$("#task_"+dataID+" .editTask").click(openDialogEditTask);$("#task_"+dataID+" .deleteTask").click(confirmDeleteTask);$this.attr("disabled",true);$("#task_notify_add").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$this.attr("disabled",true);$("#task_notify_add").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})}else{reminder.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E02")}}}else{time.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E01")}}});$(".editTask").click(openDialogEditTask);$("#udpateTask").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #udpateTask click -----------")}var taskID=$("input[name=envo_edittaskid]").val();var houseID=pageID;var priority=$("select[name=envo_edittaskpriority]").val();var status=$("select[name=envo_edittaskstatus]").val();var title=$("input[name=envo_edittasktitle]").val();var description=tinymce.get("envoEditorSmall").getContent();var reminder=$("input[name=envo_edittaskreminder]");var reminderval=reminder.val();var time=$("input[name=envo_edittasktime]");var timeval=time.val();if(timeval.length){if(reminderval.length){$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_update_task.php",type:"POST",datatype:"json",data:{taskID:taskID,houseID:houseID,priority:priority,status:status,title:title,description:description,reminder:reminderval,time:timeval},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);if(data.status=="update_success"){var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Save Task Click fn | Ajax -> Key data[id]: "+data["id"])}dataID=data["id"];if(data["description"].length>0){description=data["description"]}else{description='<span class="bold text-warning-dark">Úkol nemá popis</span>'}divdata+='<div class="taskheader bg-teal-600"><span>Task ID '+data["id"]+'</span><span class="float-right collapsetask">+</span></div>'+'<div class="taskinfo">'+'<div class="table-responsive">'+'<table class="table table-task">'+"<thead>"+"<tr>"+"<th>Titulek</th>"+"<th>Priorita</th>"+"<th>Status</th>"+"<th>Datum Úkolu</th>"+"<th>Datum Připomenutí</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+"<tr>"+"<td>"+data["title"]+"</td>"+"<td>"+data["priority"]+"</td>"+"<td>"+data["status"]+"</td>"+"<td>"+data["time"]+"</td>"+"<td>"+data["reminder"]+"</td>"+'<td class="text-center"><button type="button" id="editTask" class="btn btn-default btn-xs m-r-20 editTask" data-toggle="tooltipEnvo" title="" data-dialog="taskDialogEdit" data-id="'+data["id"]+'" data-original-title="Editovat"><i class="fa fa-edit"></i></button>'+'<button type="button" class="btn btn-danger btn-xs deleteTask" data-confirm-deltask="Jste si jistý, že chcete odstranit úkol <strong>'+data["title"]+'</strong>" data-toggle="tooltipEnvo" title="Odstranit" data-id="'+data["id"]+'"><i class="fa fa-trash-o"></i></button></td>'+"</tr>"+"</tbody>"+"</table>"+"</div>"+"</div>"+'<div class="taskcontent">'+"<p><strong >Popis Úkolu:</strong></p>"+'<div class="taskdescription">'+description+"</div>"+"</div>"})}});$("#task_"+dataID).html(divdata);$("#task_"+dataID+" .taskheader").click(clickTaskHeader);$("#task_"+dataID+" .editTask").click(openDialogEditTask);$("#task_"+dataID+" .deleteTask").click(confirmDeleteTask);$("#task_notify_edit").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$("#task_notify_edit").pgNotification({style:"bar",message:data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})}else{reminder.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E02")}}}else{time.parent().addClass("has-error");if(debug){console.log("Save Task Click fn | Error E01")}}});$(".deleteTask").click(confirmDeleteTask)});$(function(){"use strict";function getiKatastr_Link(event){event.preventDefault();if(debug){console.log("----------- fn getiKatastr_Link -----------")}var parent=$(this).parents(":eq(4)").attr("id");var wgslat=$.trim($("#"+parent+' input[name="envo_housegpslat"]').val());var wgslon=$.trim($("#"+parent+' input[name="envo_housegpslng"]').val());if(debug){console.log("Parent ID: "+parent);console.log("GPS Coordinates - Latitude: "+wgslat+" / Longitude: "+wgslon)}var ikatastr="https://www.ikatastr.cz/#kde="+wgslat+","+wgslon+",19&mapa=osm&vrstvy=parcelybudovy&info="+wgslat+","+wgslon;$("#"+parent+" input[name=envo_houseikatastr]").val(ikatastr);$("#"+parent+" .ikatastrlink a.ikatastr").attr("href",ikatastr)}function openDialogNewEnt(event){event.preventDefault();if(debug){console.log("----------- fn openDialogNewEnt -----------")}var DataDialog=$(this).attr("data-dialog");var houseID=pageID;var entrance=$(event.data.element);var entranceval=entrance.val();if(debug){console.log("Add New Entrance Click fn | Dialog ID: "+DataDialog)}if(entranceval.length){$("#"+DataDialog+" .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>');entrance.parent().removeClass("has-error");setTimeout(function(){$("#"+DataDialog+" .dialog__overview").load("/plugins/intranet2/admin/ajax/content_new_ent.php",function(responseTxt,statusTxt,xhr){if(statusTxt=="success"){if(debug){console.log("Loading content | External content loaded successfully!")}$("#"+DataDialog+' input[name="envo_entstreet"]').val(entranceval);$(".getgps").click(getGPS_Data);$("#getkatastrlink").click(getiKatastr_Link)}if(statusTxt=="error"){if(debug){console.log("Loading content | Error: "+xhr.status+": "+xhr.statusText)}}})},1e3);var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}entrance.val("");$("#"+DataDialog+" .dialog__overview").html("");$("#saveEnt").attr("disabled",false)}});dlg.toggle(dlg)}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+"Zadejte ulici a číslo vchodu."},{type:"danger",delay:5e3})},1e3);entrance.parent().addClass("has-error")}return false}function openDialogEditEnt(event){event.preventDefault();if(debug){console.log("----------- fn openDialogEditEnt -----------")}var DataDialog=$(this).attr("data-dialog");var entID=$(this).attr("data-id");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_dialog_ent.php",type:"POST",datatype:"html",data:{entID:entID},beforeSend:function(){$("#entDialogEdit .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>')},success:function(data,statusTxt){setTimeout(function(){if(statusTxt=="success"){if(debug){console.log("Loading content | External content loaded successfully!")}$("#entDialogEdit .dialog__overview").hide().html(data).fadeIn(900);$(".getgps").click(getGPS_Data);$("#getkatastrlink").click(getiKatastr_Link)}if(statusTxt=="error"){if(debug){console.log("Loading content | Error: "+xhr.status+": "+xhr.statusText)}}},1e3)},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}$("#"+DataDialog+" .dialog__overview").html("")}});dlg.toggle(dlg);return false}function deleteEnt(entID){if(debug){console.log("----------- fn deleteEnt -----------")}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_delete_ent.php",type:"POST",datatype:"json",data:{entID:entID},success:function(data){if(data.status=="delete_success"){$("#ent_"+data.data[0].id).remove();setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:5e3})},1e3)}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});return false}function confirmDeleteEnt(event){event.preventDefault();if(debug){console.log("----------- fn confirmDeleteEnt -----------")}var entID=$(this).attr("data-id");bootbox.setLocale(envoWeb.envo_lang);bootbox.confirm({title:"Potvrzení o odstranění!",message:$(this).attr("data-confirm-delent"),className:"bootbox-confirm-del",animate:true,buttons:{confirm:{className:"btn-success"},cancel:{className:"btn-danger"}},callback:function(result){if(result==true){if(debug){console.log("Delete Entrance - ID: "+entID)}deleteEnt(entID)}}});return false}$("#addEnt").click({element:'input[name="addEnt"]'},openDialogNewEnt);$("#saveEnt").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #saveEnt click -----------")}var $this=$(this);var parent=$this.parents(":eq(3)").attr("id");var houseID=pageID;var street=$("#"+parent+" input[name=envo_entstreet]").val();var elevator=$("#"+parent+" input[name=envo_entelevator]:checked").val();var apartment=$("#"+parent+" input[name=envo_entapartment]").val();var gpslat=$("#"+parent+" input[name=envo_housegpslat]");var gpslatval=gpslat.val();var gpslng=$("#"+parent+" input[name=envo_housegpslng]");var gpslngval=gpslng.val();var katastr=$("#"+parent+" input[name=envo_houseikatastr]").val();if(debug){console.log("Save Entrance Click fn | Data => parentID - "+parent+" | houseID - "+houseID+" | street -  "+street+" | elevator - "+elevator+" | apartment - "+apartment+" | gpslat - "+gpslatval+" | gpslng - "+gpslngval+" | katastr - "+katastr)}if(gpslatval.length||gpslngval.length){$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_addnew_ent.php",type:"POST",datatype:"json",data:{houseID:houseID,street:street,elevator:elevator,apartment:apartment,gpslat:gpslatval,gpslng:gpslngval,katastr:katastr},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);if(data.status=="success"){var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){dataID=data["id"];divdata+='<div class="box box-success"  id="ent_'+dataID+'">'+'<div class="box-header with-border">'+'<h3 class="box-title">Vchod <span class="bold">'+data["street"]+"</span></h3>"+'<span class="float-right bold">Ent ID '+dataID+"</span>"+"</div>"+'<div class="box-body no-padding">'+'<div class="block">'+'<div class="block-content">'+'<div class="col-sm-6 p-3">'+'<table class="table table-hover table-condensed">'+'<caption style="caption-side: top;">'+'<span class="m-r-20"><strong>GPS - Koordináty</strong></span>'+""+"</caption>"+"<tbody>"+"<tr>"+'<th style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Latitude</strong>"+"</th>"+'<td style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslat"]+"</span>"+"</td>"+"</tr>"+"<tr>"+'<th style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Longitude</strong>"+"</th>"+'<td style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslng"]+"</span>"+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>"+'<div class="col-sm-6 p-3">'+""+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="box-footer">'+'<button type="button" class="btn btn-danger  float-right deleteEnt" data-confirm-delent="Jste si jistý, že chcete odstranit vchod <strong>'+data["street"]+'</strong>" data-toggle="tooltipEnvo" data-placement="bottom" title="Odstranit" data-id="'+dataID+'"><i class="fa fa-trash-o"></i> Odstranění vchodu</button>'+'<button type="button" id="editEnt" class="btn btn-default float-right m-r-20 editEnt" data-toggle="tooltipEnvo" data-placement="bottom" title="Editace" data-dialog="entDialogEdit" data-id="'+dataID+'"><i class="fa fa-edit"></i> Editace vchodu</button>'+"</div>"+"</div>"})}});var divalert=$("#entlist .alert.bg-info");if(divalert){divalert.parent().remove()}$("#entlist").prepend(divdata);$("#ent_"+dataID+" .editEnt").click(openDialogEditEnt);$("#ent_"+dataID+" .deleteEnt").click(confirmDeleteEnt);$this.attr("disabled",true);$("#ent_notify_add").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$this.attr("disabled",true);$("#ent_notify_add").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})}else{gpslat.parent().addClass("has-error");gpslng.parent().addClass("has-error");if(debug){console.log("Save Ent Click fn | Error E01")}}});$(".editEnt").click(openDialogEditEnt);$("#udpateEnt").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #udpateEnt click -----------")}var $this=$(this);var parent=$this.parents(":eq(3)").attr("id");var entID=$("#"+parent+" input[name=envo_editentid]").val();var street=$("#"+parent+" input[name=envo_entstreet]").val();var elevator=$("#"+parent+" input[name=envo_entelevator]:checked").val();var apartment=$("#"+parent+" input[name=envo_entapartment]").val();var gpslat=$("#"+parent+" input[name=envo_housegpslat]");var gpslatval=gpslat.val();var gpslng=$("#"+parent+" input[name=envo_housegpslng]");var gpslngval=gpslng.val();var katastr=$("#"+parent+" input[name=envo_houseikatastr]").val();if(debug){console.log("Update Entrance Click fn | Data => parentID - "+parent+" | entID - "+entID+" | street -  "+street+" | elevator - "+elevator+" | apartment - "+apartment+" | gpslat - "+gpslatval+" | gpslng - "+gpslngval+" | katastr - "+katastr)}if(gpslatval.length||gpslngval.length){$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_update_ent.php",type:"POST",datatype:"json",data:{entID:entID,street:street,elevator:elevator,apartment:apartment,gpslat:gpslatval,gpslng:gpslngval,katastr:katastr},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);if(data.status=="update_success"){var divdata="";var dataID="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Save Task Ent fn | Ajax -> Key data[id]: "+data["id"])}dataID=data["id"];divdata+='<div class="box-header with-border"><h3 class="box-title">Vchod <span class="bold">'+data["street"]+"</span></h3></div>"+'<div class="box-body no-padding">'+'<div class="block">'+'<div class="block-content">'+'<div class="col-sm-6 p-3">'+'<table class="table table-hover table-condensed">'+'<caption style="caption-side: top;">'+'<span class="m-r-20"><strong>GPS - Koordináty</strong></span>'+""+"</caption>"+"<tbody>"+"<tr>"+'<th style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Latitude</strong>"+"</th>"+'<td style="border-top: 1px solid rgba(230,230,230,0.7);border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslat"]+"</span>"+"</td>"+"</tr>"+"<tr>"+'<th style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<strong>GPS - Longitude</strong>"+"</th>"+'<td style="border-top: none;border-bottom: 1px solid rgba(230,230,230,0.7);">'+"<span>"+data["gpslng"]+"</span>"+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>"+'<div class="col-sm-6 p-3">'+""+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="box-footer">'+'<button type="button" class="btn btn-danger  float-right deleteEnt" data-confirm-delent="Jste si jistý, že chcete odstranit vchod <strong>'+data["street"]+'</strong>" data-toggle="tooltipEnvo" data-placement="bottom" title="Odstranit" data-id="'+dataID+'"><i class="fa fa-trash-o"></i> Odstranění vchodu</button>'+'<button type="button" id="editEnt" class="btn btn-default float-right m-r-20 editEnt" data-toggle="tooltipEnvo" data-placement="bottom" title="Editace" data-dialog="entDialogEdit" data-id="'+dataID+'"><i class="fa fa-edit"></i> Editace vchodu</button>'+"</div>"})}});$("#ent_"+dataID).html(divdata);$("#ent_"+dataID+" .editEnt").click(openDialogEditEnt);$("#ent_"+dataID+" .deleteEnt").click(confirmDeleteEnt);$("#ent_notify_edit").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$("#ent_notify_edit").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})}else{gpslat.parent().addClass("has-error");gpslng.parent().addClass("has-error");if(debug){console.log("Update Ent Click fn | Error E01")}}});$(".deleteEnt").click(confirmDeleteEnt)});$(function(){"use strict";$(".file-clear").click(function(){var parent=$(this).parents(":eq(1)").attr("id");$("#"+parent+" .file-filename").val("");$("#"+parent+" .file-clear").hide();$("#"+parent+" .file-input input:file").val("");$("#"+parent+" .file-input").css("border-radius","3px 0 0 3px");$("#"+parent+" .file-input-title").text("Vybrat Soubor")});$(".file-input input:file").change(function(){var parent=$(this).parents(":eq(2)").attr("id");var file=this.files[0];if(debug){console.log($(this).val())}if($(this).val()!=""){$("#"+parent+" .file-input").css("border-radius","0");$("#"+parent+" .file-input-title").text("Změnit");$("#"+parent+" .file-clear").show();$("#"+parent+" .file-filename").val(file.name)}else{$("#"+parent+" .file-filename").val("");$("#"+parent+" .file-clear").hide();$("#"+parent+" .file-input-title").text("Vybrat Soubor")}})});$(function(){"use strict";$("#uploadBtnDocu").on("click",function(event){event.preventDefault();if(debug){console.log("----------- fn #uploadBtnDocu click -----------")}var desc=$('input[name="envo_descdocu"]');var descval=desc.val();var file_data=$("#fileinput_doc").prop("files")[0];var folder_path=$('input[name="folderpath"]').val();var form_data=new FormData;form_data.append("file",file_data);form_data.append("folderpath",folder_path);form_data.append("houseID",pageID);form_data.append("description",descval);$(".has-error-text").remove();desc.parent().removeClass("has-error");if(descval.length){$("#docuoutput").hide();$("#docuprogress").show();$("#docupercent").html("0%");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_upload_docu.php",type:"POST",data:form_data,contentType:false,cache:false,processData:false,beforeSend:function(){},xhr:function(){var xhr=new window.XMLHttpRequest;xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var loaded=evt.loaded;var total=evt.total;var percent=loaded/total*100;var percentComplete=percent.toFixed(2)+"%";var byteRec=formatFileSize(loaded);var totalByte=formatFileSize(total);$("#docuprogressbar").css("width",percentComplete);$("#docupercent").html(percentComplete);$("#docubyterec").html(byteRec);$("#docubytetotal").html(totalByte)}},false);return xhr},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);if(data.status=="upload_success"){$("#docuoutput").html('<div class="alert alert-success" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Success: </strong>"+data.status_msg+"</div>");var tabledata="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){if(debug){console.log("Upload File fn | Data => id - "+data["id"]+" | fsize -  "+data["fsize"]+" | ftime - "+data["ftime"]+" | ficon - "+data["ficon"]+" | description - "+data["description"]+" | fullpath - "+data["fullpath"])}tabledata+="<tr>"+'<td class="text-center">'+data["id"]+"</td>"+'<td class="text-center">'+data["ficon"]+"</td>"+"<td>"+data["description"]+"</td>"+'<td class="text-center"><a href="'+data["fullpath"]+'" target="_blank">Zobrazit</a> | <a href="'+data["fullpath"]+'" download>Stáhnout</a></td>'+"</tr>"})}});$("#tabledocu tbody").html(tabledata);desc.val("");$("#upload .file-filename").val("");$("#upload .file-clear").hide();$("#upload .file-input input:file").val("");$("#upload .file-input").css("border-radius","3px 0 0 3px");$("#upload .file-input-title").text("Vybrat Soubor");setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else if(data.status.indexOf("upload_error")!=-1){$("#docuoutput").html('<div class="alert alert-danger" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Error: </strong>"+data.status+" => "+data.status_msg+"</div>");setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){$("#docuprogress").hide();$("#docuprogressbar").css("width","");$("#docuoutput").show()}})}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+"Zadejte popis souboru."},{type:"danger",delay:5e3})},1e3);desc.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:"absolute"},text:"Vyplňte označenou položku"}).appendTo(desc.parent())}})});$(function(){"use strict";function debounce(fn,threshold){var timeout;return function debounced(){if(timeout){clearTimeout(timeout)}function delayed(){fn();timeout=null}setTimeout(delayed,threshold||100)}}function openDialogEditImg(event){event.preventDefault();if(debug){console.log("----------- fn openDialogEditImg -----------")}var DataDialog=$(this).attr("data-dialog");var imageID=$(this).parents(":eq(4)").attr("id");var imageSuffixID=parseInt(/^.*\_(\d+)$/.exec(imageID)[1]);if(debug){console.log("Image ID from DIV: "+imageSuffixID)}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_dialog_img.php",type:"POST",datatype:"html",data:{imageID:imageSuffixID},beforeSend:function(){$("#imgDialogEdit .dialog__overview").html('<div style="display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20">Načítání ... Prosím počkejte</div></div>')},success:function(data){setTimeout(function(){$("#imgDialogEdit .dialog__overview").hide().html(data).fadeIn(900);var imgo=$("#imgfolderoriginal_path").val();$("#imgfolderoriginal").attr("href",imgo);$("#info1 .selectpicker").select2({minimumResultsForSearch:-1,dropdownParent:$(".page-content-wrapper"),dropdownCssClass:"zindex1060"})},1e3)},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});var dialogEl=document.getElementById(DataDialog);var dlg=new DialogFx(dialogEl,{onOpenDialog:function(instance){if(debug){console.log("DialogFX: OPEN")}},onCloseDialog:function(instance){if(debug){console.log("DialogFX: CLOSE")}}});dlg.toggle(dlg);return false}function deleteImg(imageID){if(debug){console.log("----------- fn deleteImg -----------")}$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_delete_img.php",type:"POST",datatype:"json",data:{imageID:imageID},success:function(data){if(data.status=="delete_success"){var $removeItem=$("#gallery_1_"+data.data[0].id);$gallery.isotope("remove",$removeItem).isotope("layout");$("#gallery_0_"+data.data[0].id).remove();setTimeout(function(){$.notify({message:"<strong>Success:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:5e3})},1e3)}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}});return false}function confirmdeleteImg(event){event.preventDefault();if(debug){console.log("----------- fn confirmdeleteImg -----------")}var imageID=$(this).attr("data-id");bootbox.setLocale(envoWeb.envo_lang);bootbox.confirm({title:"Potvrzení o odstranění!",message:$(this).attr("data-confirm-delimg"),className:"bootbox-confirm-del",animate:true,buttons:{confirm:{className:"btn-success"},cancel:{className:"btn-danger"}},callback:function(result){if(result==true){if(debug){console.log("Delete Image - ID: "+imageID)}deleteImg(imageID)}}});return false}var isotopgallery=$("#gallery_envo_1");if(isotopgallery.length){var qsRegex;var buttonFilter;var $gallery=$("#gallery_envo_1");$gallery.isotope({itemSelector:'div[class^="gallery-item-"]',masonry:{columnWidth:280,gutter:10,isFitWidth:true},filter:function(){var $this=$(this);var searchResult=qsRegex?$this.text().match(qsRegex):true;var buttonResult=buttonFilter?$this.is(buttonFilter):true;return searchResult&&buttonResult}});var $quicksearch=$("#quicksearch").keyup(debounce(function(){qsRegex=new RegExp($quicksearch.val(),"gi");$gallery.isotope()}));$("#imagefilters").on("click",".filter",function(event){event.preventDefault();var $this=$(this);buttonFilter=$(this).attr("data-filter");$gallery.isotope()});$("#imagefilters .filter").on("click",function(){$("#imagefilters").find(".active").removeClass("active");$(this).addClass("active")});$('a[href="#cmsPage11"]').on("shown.bs.tab",function(e){$gallery.isotope("layout")})}$("#showPhotoList").on("click",function(e){$(this).removeClass("btn-info").addClass("btn-complete");$("#showFiltrPhoto").removeClass("btn-complete").addClass("btn-info");$("#list_photo").fadeIn(500);$("#isotope_photo").fadeOut(500)});$("#showFiltrPhoto").on("click",function(e){$(this).removeClass("btn-info").addClass("btn-complete");$("#showPhotoList").removeClass("btn-complete").addClass("btn-info");$("#isotope_photo").fadeIn(500);$("#list_photo").fadeOut(500);setTimeout(function(){$gallery.isotope("layout")},500)});$("#uploadBtnImg").on("click",function(event){event.preventDefault();if(debug){console.log("----------- fn #uploadBtnImg click -----------")}var imgsdesc=$('input[name="envo_sdescimg"]');var imgsdescval=imgsdesc.val();var imgcat=$('select[name="envo_imgcategory"]');var imgcatval=imgcat.val();var file_data=$("#fileinput_img").prop("files")[0];var folder_path=$('input[name="folderpath"]').val();var form_data=new FormData;form_data.append("file",file_data);form_data.append("folderpath",folder_path);form_data.append("houseID",pageID);form_data.append("imgSdesc",imgsdescval);form_data.append("imgCat",imgcatval);$(".has-error-text").remove();imgsdesc.parent().removeClass("has-error");imgcat.parent().removeClass("has-error");if(imgcatval.length){if(imgsdescval.length){$("#imgoutput").hide();$("#imgprogress").show();$("#imgpercent").html("0%");$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_upload_img.php",type:"POST",data:form_data,contentType:false,cache:false,processData:false,beforeSend:function(){},xhr:function(){var xhr=new window.XMLHttpRequest;xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var loaded=evt.loaded;var total=evt.total;var percent=loaded/total*100;var percentComplete=percent.toFixed(2)+"%";var byteRec=formatFileSize(loaded);var totalByte=formatFileSize(total);$("#imgprogressbar").css("width",percentComplete);$("#imgpercent").html(percentComplete);$("#imgbyterec").html(byteRec);$("#imgbytetotal").html(totalByte)}},false);return xhr},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);if(data.status=="upload_success"){$("#imgoutput").html('<div class="alert alert-success" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Success: </strong>"+data.status_msg+"</div>");var divdata="";$.each(result,function(key,data){if(key==="data"){$.each(data,function(index,data){var $isotopeContent=$(""+'<div id="gallery_1_'+data["id"]+'" class="gallery-item-'+data["id"]+" "+data["category"]+'" data-width="1" data-height="1">'+'<div class="img_container"><img src="'+data["filethumbpath"]+'" alt="" class="image-responsive-height"></div>'+'<div class="overlays full-width">'+'<div class="row full-height">'+'<div class="col-5 full-height">'+'<div class="text font-montserrat">'+data["filenamethumb"].substring(data["filenamethumb"].lastIndexOf(".")+1).toUpperCase()+"</div>"+"</div>"+'<div class="col-7 full-height">'+'<div class="text">'+'<a data-fancybox="gallery" href="'+data["filethumbpath"]+'">'+'<button class="btn btn-info btn-xs btn-mini mr-1 fs-14" type="button"><i class="pg-image"></i></button>'+"</a>"+'<button class="btn btn-info btn-xs btn-mini fs-14 dialog-open-img mr-1" type="button" data-dialog="imgDialogEdit"><i class="fa fa-edit"></i></button>'+'<button class="btn btn-info btn-xs btn-mini fs-14 delete-img" type="button" data-id="'+data["id"]+'"  data-confirm-delimg="Jste si jistý, že chcete odstranit obrázek?"><i class="fa fa-trash"></i></button>'+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="full-width padding-10">'+'<p class="bold">Krátký Popis</p><p class="shortdesc">'+data["shortdescription"]+"</p>"+"</div>"+"</div>");$gallery.prepend($isotopeContent).isotope("prepended",$isotopeContent);var elClass=$("#gallery_1_"+data["id"]+".gallery-item-"+data["id"]);elClass.find(".dialog-open-img").click(openDialogEditImg);elClass.find(".delete-img").click(confirmdeleteImg);var divalert=$("#isotope_photo .alert.bg-info");if(divalert){divalert.parent().remove()}})}});setTimeout(function(){$.notify({message:"<strong>Error:</strong> "+data.status_msg},{type:"success",delay:2e3})},1e3)}else if(data.status.indexOf("upload_error")!=-1){$("#imgoutput").html('<div class="alert alert-danger" role="alert">'+'<button class="close" data-dismiss="alert"></button>'+"<strong>Error: </strong>"+data.status+" => "+data.status_msg+"</div>");setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){$("#imgprogress").hide();$("#imgprogressbar").css("width","");$("#imgoutput").show()}})}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+"Zadejte popis souboru."},{type:"danger",delay:5e3})},1e3);imgsdesc.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:"absolute"},text:"Vyplňte označenou položku"}).appendTo(imgsdesc.parent())}}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+"Vyberte kategorii."},{type:"danger",delay:5e3})},1e3);imgcat.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:"absolute"},text:"Vyplňte označenou položku"}).appendTo(imgcat.parent())}});$(".delete-img").click(confirmdeleteImg);$(".dialog-open-img").click(openDialogEditImg);$("#udpateImg").on("click",function(e){e.preventDefault();if(debug){console.log("----------- fn #udpateImg click -----------")}var imageID=$("input[name=envo_editimgid]").val();var descImage=$("#desc").val();var shortdescImage=$("#shortdesc").val();var catImage=$('select[name="envo_imgcategory_dialog"]').val();$.ajax({url:"/plugins/intranet2/admin/ajax/int2_table_update_img.php",type:"POST",datatype:"json",data:{imageID:imageID,descImage:descImage,shortdescImage:shortdescImage,catImage:catImage},success:function(data){if(data.status=="update_success"){$("#timeedit").html(data.data[0].timeedit);var elClass0=$("#gallery_1_"+data.data[0].id+".gallery-item-"+data.data[0].id);elClass0.find(".shortdesc").text(data.data[0].shortdescription);var elClass1=$("#gallery_1_"+data.data[0].id).attr("class").split(" ")[0];$("#gallery_1_"+data.data[0].id+"."+elClass1).removeClass().addClass(elClass1+" "+data.data[0].category);$("#img_notify_edit").pgNotification({style:"bar",message:"<strong>Success:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"success",showClose:false}).show()}else{$("#img_notify_edit").pgNotification({style:"bar",message:"<strong>Error:</strong> "+data.status_msg,position:"top",timeout:2e3,type:"danger",showClose:false}).show()}},error:function(jqXHR,textStatus,errorThrown){if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}},complete:function(){}})})});$(function(){"use strict";$("#card-help").card();$("#card-basic").card();$("#card-result").card();$("#searchAresIc").submit(function(e){e.preventDefault();if(debug){console.log("----------- fn #searchAresIc submit -----------")}var form=$(this);var ares_ico=$('input[name="ares_ico"]');var ares_icoval=$.trim(ares_ico.val());var ajaxTime=(new Date).getTime();$(".has-error-text").remove();ares_ico.parent().removeClass("has-error");if(ares_icoval.length&&$.isNumeric(ares_icoval)){$.ajax({url:"/plugins/intranet2/admin/ajax/searchares_ic.php",type:form.attr("method"),dataType:"json",data:{ares_ico:ares_icoval},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("");if(data.status=="upload_success"){var divdata="";divdata+="<p><strong>"+data.status_msg+"</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime">'+totalTime+'</span><span class="float-right">Počet nalezených záznamů: <strong>'+data.count_data+"</strong></span></p>"+"<p>Vyhledávací řetězec: <span>ico="+result.search_string.ares_ico+"</span></p><hr>";divdata+='<table class="table">';divdata+="<thead><tr><th>IČ</th><th>Název subjektu</th><th>Sídlo</th></tr></thead>";divdata+="<tbody>";$.each(data,function(key,value){if(key==="data"){$.each(value,function(key1,value1){divdata+="<tr><td>"+value1.ico+"</td><td>"+value1.ojm+"</td><td>"+value1.jmn+"</td></tr>"})}});divdata+="</tbody></table>"}else{var divdata="";divdata+='<p style="color: #C10000;"><i class="fa fa-exclamation"></i> <strong>'+data.status_msg+"</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime">'+totalTime+'</span><span class="float-right">Počet nalezených záznamů: <strong>'+data.count_data+"</strong></span></p>"+"<p>Vyhledávací řetězec: <span>ares_obec="+result.search_string.ares_obec+" ares_ulice="+result.search_string.ares_ulice+" ares_corientacni="+result.search_string.ares_corientacni+" ares_cpopisne="+result.search_string.ares_cpopisne+"</span></p><hr>"+"<p>"+data.status_info+" => ";$.each(data.data,function(key,value){$.each(value,function(key1,value1){divdata+="<span>"+value1+"</span> "})});divdata+="</p>";setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}$("#outputaresdata").html("").prepend(divdata);$("#ajaxTime").html(totalTime)},error:function(jqXHR,textStatus,errorThrown){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;color: #C10000;font-weight: 700;">Vypršel časový limit pro komunikaci se serverem Ares</span><span style="color: #C10000; font-weight: 700;">Server Ares neodpovídá -> obnovte stránku a zkuste hledání později!</span></div></div>');if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}if(textStatus==="timeout"){if(debug)console.log("Timeout: "+textStatus+": "+errorThrown)}else{if(debug)console.log(textStatus+": "+errorThrown)}},complete:function(){}})}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+"Zadejte IČ ve správném formátu. Zadejte jen čísla 0-9"},{type:"danger",delay:5e3})},1e3);ares_ico.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:""},text:"Vyplňte označenou položku"}).appendTo(ares_ico.parent());if(debug){console.log("#searchAresIc submit fn | Error E01")}}});$("#searchAresOther").submit(function(e){e.preventDefault();if(debug){console.log("----------- fn #searchAresOther submit -----------")}var form=$(this);var ares_maxcount=$("#ares_maxcount");var ares_maxcountval=ares_maxcount.val();var ares_sort=$("#ares_sort");var ares_sortval=ares_sort.val();var ares_word=$("#ares_word");var ares_wordval=ares_word.val();var ares_obec=$('select[name="ares_obec"]');var ares_obecval=$.trim(ares_obec.val());var ares_ulice=$('select[name="ares_ulice"]');var ares_uliceval=$.trim(ares_ulice.val());var ares_corientacni=$('input[name="ares_corientacni"]');var ares_corientacnival=$.trim(ares_corientacni.val());var ares_cpopisne=$('input[name="ares_cpopisne"]');var ares_cpopisneval=$.trim(ares_cpopisne.val());var ares_record=$("input[name=recordDb]:checked");var ares_recordval=ares_record.val();var ajaxTime=(new Date).getTime();$(".has-error-text").remove();ares_obec.parent().removeClass("has-error");ares_ulice.parent().removeClass("has-error");if(ares_obecval.length&&$.isNumeric(ares_obecval)){$.ajax({url:"/plugins/intranet2/admin/ajax/searchares_other.php",type:form.attr("method"),dataType:"json",data:{ares_maxcount:ares_maxcountval,ares_sort:ares_sortval,ares_word:ares_wordval,ares_obec:ares_obecval,ares_ulice:ares_uliceval,ares_corientacni:ares_corientacnival,ares_cpopisne:ares_cpopisneval,ares_record:ares_recordval},cache:false,timeout:2e4,beforeSend:function(){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="progress-circle-indeterminate"></div><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;">Načítání ... Prosím počkejte ...</span><span>Načítání dat může trvat i několik sekund / minut</span></div></div>').show()},success:function(data){var str=JSON.stringify(data);var result=JSON.parse(str);var totalTime=msToTime(Math.floor((new Date).getTime()-ajaxTime));if(debug){console.log("ajaxTime | Success Time: "+totalTime)}$("#loadingdata").hide().html("");if(data.status=="upload_success"){var divdata="";divdata+="<p><strong>"+data.status_msg+"</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime">'+totalTime+'</span><span class="float-right">Počet nalezených záznamů: <strong>'+data.count_data+"</strong></span></p>"+"<p>Vyhledávací řetězec: <span>ares_obec="+result.search_string.ares_obec+" ares_ulice="+result.search_string.ares_ulice+" ares_corientacni="+result.search_string.ares_corientacni+" ares_cpopisne="+result.search_string.ares_cpopisne+"</span></p><hr>";divdata+='<table class="table">';divdata+="<thead><tr><th>IČ</th><th>Název subjektu</th><th>Sídlo</th></tr></thead>";divdata+="<tbody>";$.each(data,function(key,value){if(key==="data"){$.each(value,function(key1,value1){divdata+="<tr><td>"+value1.ico+"</td><td>"+value1.ojm+"</td><td>"+value1.jmn+"</td></tr>"})}});divdata+="</tbody></table>"}else{var divdata="";divdata+='<p style="color: #C10000;"><i class="fa fa-exclamation"></i> <strong>'+data.status_msg+"</strong></p>"+'<p>Doba zpracování požadavku: <span id="ajaxTime">'+totalTime+'</span><span class="float-right">Počet nalezených záznamů: <strong>'+data.count_data+"</strong></span></p>"+"<p>Vyhledávací řetězec: <span>ares_obec="+result.search_string.ares_obec+" ares_ulice="+result.search_string.ares_ulice+" ares_corientacni="+result.search_string.ares_corientacni+" ares_cpopisne="+result.search_string.ares_cpopisne+"</span></p><hr>"+"<p>"+data.status_info+" => ";$.each(data.data,function(key,value){$.each(value,function(key1,value1){divdata+="<span>"+value1+"</span> "})});divdata+="</p>";setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+data.status_msg},{type:"danger",delay:2e3})},1e3)}$("#outputaresdata").html("").prepend(divdata);$("#ajaxTime").html(totalTime)},error:function(jqXHR,textStatus,errorThrown){$("#loadingdata").html('<div style="display:block;position:fixed;top:50%;left:50%;transform:translate(-35%, -50%);-ms-transform:translate(-35%, -50%);"><div class="m-t-20 text-center"><span style="float: left;width: 100%;margin-bottom: 10px;font-weight: bold;font-size: 2em;">ARES</span><span style="float: left;width: 100%;margin-bottom: 10px;color: #C10000;font-weight: 700;">Vypršel časový limit pro komunikaci se serverem Ares</span><span style="color: #C10000; font-weight: 700;">Server Ares neodpovídá -> obnovte stránku a zkuste hledání později!</span></div></div>');if(debug){console.log("Could not get posts, server response: "+textStatus+": "+errorThrown)}if(textStatus==="timeout"){if(debug)console.log("Timeout: "+textStatus+": "+errorThrown)}else{if(debug)console.log(textStatus+": "+errorThrown)}},complete:function(){}})}else{setTimeout(function(){$.notify({icon:"fa fa-exclamation",message:"<strong>Error:</strong> "+"Zadejte obec ve správném formátu. Zadejte jen čísla 0-9"},{type:"danger",delay:5e3})},1e3);ares_obec.parent().addClass("has-error");$("<div/>",{class:"has-error-text",css:{fontWeight:"normal",color:"#C10000",position:""},text:"Vyplňte označenou položku"}).appendTo(ares_obec.parent());if(debug){console.log("#searchAresOther submit fn | Error E01")}}})});$(function(){"use strict"});